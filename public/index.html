<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.1.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.2">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="开发者技术圈圈圈">
<meta property="og:url" content="http://techq.xyz/index.html">
<meta property="og:site_name" content="开发者技术圈圈圈">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者技术圈圈圈">





  
  
  <link rel="canonical" href="http://techq.xyz/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>开发者技术圈圈圈</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者技术圈圈圈</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">溪源的技术博客，技术的不断进取之路</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-技术">

    
    
    
      
    

    

    <a href="/categories/技术/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>技术</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-随笔">

    
    
    
      
    

    

    <a href="/categories/随笔/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>随笔</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-读书">

    
    
    
      
    

    

    <a href="/categories/读书/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>读书</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-管理">

    
    
    
      
    

    

    <a href="/categories/管理/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>管理</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-归档">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archives"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://techq.xyz/2020/06/25/随笔/test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="溪源">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者技术圈圈圈">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/06/25/随笔/test/" class="post-title-link" itemprop="url">test</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-25 22:06:13 / Modified: 22:12:49" itemprop="dateCreated datePublished" datetime="2020-06-25T22:06:13+08:00">2020-06-25</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/随笔/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <img src="/2020/06/25/随笔/test/test.png" title="This is an example image">

<p><img src="test.png" alt="alt"></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://techq.xyz/2020/06/25/技术/如何在ASP.NET Core中使用SignalR构建与Angular通信的实时通信应用程序/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="溪源">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者技术圈圈圈">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/06/25/技术/如何在ASP.NET Core中使用SignalR构建与Angular通信的实时通信应用程序/" class="post-title-link" itemprop="url">如何在ASP.NET Core中使用SignalR构建与Angular通信的实时通信应用程序</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-25 20:05:00 / Modified: 21:59:43" itemprop="dateCreated datePublished" datetime="2020-06-25T20:05:00+08:00">2020-06-25</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://uploader.shimo.im/f/ByiYlxtK4DIP8lsr.png!thumbnail" alt="图片"></p>
<p>假设我们要创建一个监视Web应用程序，该应用程序为用户提供了一个能够显示一系列信息的仪表板，这些信息会随着时间的推移而更新。</p>
<p>第一种方法是在定义的时间间隔（<em>轮询</em>）定期调用API 以更新仪表板上的数据。</p>
<p>无论如何，还是有一个问题：如果没有更新的数据，我们会因请求而不必要地增加网络流量。一种替代方法是<em>长轮询</em>技术：如果服务器没有可用数据，则它可以使请求保持活动状态，直到发生某种情况或达到预设的超时时间为止，而不是发送空响应。如果存在新数据，则完整的响应将到达客户端。完全不同的方法是反转角色：当有新数据可用（推送）时，后端与客户端联系。</p>
<p>请记住，HTML 5具有标准化的WebSocket，这是一个永久的双向连接，可以在兼容的浏览器中使用Javascript接口进行配置。不幸的是，必须在客户端和服务器端都对WebSocket提供完全支持，以使其可用。然后，我们需要提供替代系统（<em>fallback</em>），无论如何，该替代系统都允许我们的应用程序运行。</p>
<p>微软于2013年发布了一个名为<strong>SignalR</strong> for <strong>ASP.NET</strong>的开源库，该库<strong>已于</strong> 2018年为ASP.NET Core进行了重写。SignalR从与通信机制有关的所有细节中进行抽象，并从可用的信息中选择最佳的一种。结果是有可能编写代码，就像我们一直处于<em>push-mode一样</em>。使用SignalR，服务器可以在其所有连接的客户端或特定客户端上调用JavaScript方法。</p>
<p>我们使用web-api模板创建一个ASP.NET Core项目，删除已生成的示例控制器。使用NuGet，我们将<em>Microsoft.AspNet.SignalR</em>添加到项目中，以创建<strong>Hub</strong>。集线器是能够调用客户端代码，发送包含所请求方法的名称和参数的消息的高级管道。作为参数发送的对象将使用适当的协议反序列化。客户端在页面代码中搜索与名称相对应的方法，如果找到该名称，则将其调用并传递反序列化的数据作为参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">using Microsoft.AspNetCore.SignalR;</span><br><span class="line"> </span><br><span class="line">namespace SignalR.Hubs</span><br><span class="line">&#123;</span><br><span class="line">    public class NotificationHub : Hub &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您可能知道，在ASP.NET Core中，可以配置HTTP请求的管理管道，以添加一些<strong>中间件</strong>，该<strong>中间件</strong>可拦截请求，添加已配置的功能并使其进入下一个中间件。必须预先配置SignalR中间件，在<strong>Startup</strong>  类的<em>ConfigureServices</em>方法中添加扩展方法<em>services.AddSignalR（）</em>。现在，我们可以使用Startup类的<em>Configure</em>方法中的扩展方法app.UseSignalR（）将中间件添加到管道中。在此操作期间，我们可以传递配置参数，包括集线器的路由：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.UseSignalR(route =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    route.MapHub&lt;notificationhub&gt;(&quot;/notificationHub&quot;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>一个有趣的场景允许我们查看ASP.NET Core中的另一个有趣功能，即在<strong>后台工作</strong>进程上下文中<em>托管</em> SignalR Hub 。<br>假设我们要实现以下用例：</p>
<ul>
<li>运行业务逻辑</li>
<li>等一下</li>
<li>决定是停止还是重复该过程。</li>
</ul>
<p>在ASP.NET Core中，我们可以使用框架提供的<em>IHostedService</em>接口在.NET Core应用程序中在后台实现进程的执行。方法要实现是<em>StartAsync（）</em>和*StopAsync（） *。非常简单：StartAsync调用到主机启动，而StopAsync调用到主机关闭。</p>
<p>然后，我们将一个类<em>DashboardHostedService</em>添加到项目中，该类实现<em>IHostedService</em>。我们在Startup类的<em>ConfigureServices</em>方法中添加接口注册：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">services.AddHostedService&lt;dashboardhostedservice&gt;();</span><br></pre></td></tr></table></figure>

<p>在类构造函数<em>DashboardHostedService中，<em>我们注入</em>IHubContext</em> 访问添加到我们应用程序的集线器。<br>在方法StartAsync中，我们设置了一个计时器，它将每两秒钟运行一次方法DoWork（）中包含的代码。此方法发送带有四个随意生成的字符串的消息。</p>
<p>但是它向谁传播呢？在我们的示例中，我们正在将消息发送到所有连接的客户端。但是，SignalR提供了向单个用户或用户组发送消息的机会。在<a href="https://docs.microsoft.com/en-us/aspnet/core/signalr/groups?view=aspnetcore-2.2" target="_blank" rel="noopener">本文中</a>，您将找到涉及ASP.NET Core中的身份验证和授权功能的详细信息。有趣的是，用户可以同时在台式机和移动设备上连接。每个设备都有一个单独的SignalR连接，但是它们都将与同一用户关联。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">using Microsoft.AspNetCore.SignalR;</span><br><span class="line">using Microsoft.Extensions.Hosting;</span><br><span class="line">using SignalR.Hubs;</span><br><span class="line">using System;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Threading;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line"> </span><br><span class="line">namespace SignalR</span><br><span class="line">&#123;</span><br><span class="line">    public class DashboardHostedService: IHostedService</span><br><span class="line">    &#123;</span><br><span class="line">        private Timer _timer;</span><br><span class="line">        private readonly IHubContext&lt;notificationhub&gt; _hubContext;</span><br><span class="line"> </span><br><span class="line">        public DashboardHostedService(IHubContext&lt;notificationhub&gt; hubContext)</span><br><span class="line">        &#123;</span><br><span class="line">            _hubContext = hubContext;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        public Task StartAsync(CancellationToken cancellationToken)</span><br><span class="line">        &#123;</span><br><span class="line">            _timer = new Timer(DoWork, null, TimeSpan.Zero,</span><br><span class="line">            TimeSpan.FromSeconds(2));</span><br><span class="line"> </span><br><span class="line">            return Task.CompletedTask;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        private void DoWork(object state)</span><br><span class="line">        &#123;</span><br><span class="line">            _hubContext.Clients.All.SendAsync(&quot;SendMessage&quot;, </span><br><span class="line">                new &#123;</span><br><span class="line">                    val1 = getRandomString(),</span><br><span class="line">                    val2 = getRandomString(),</span><br><span class="line">                    val3 = getRandomString(),</span><br><span class="line">                    val4 = getRandomString()</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        public Task StopAsync(CancellationToken cancellationToken)</span><br><span class="line">        &#123;</span><br><span class="line">            _timer?.Change(Timeout.Infinite, 0);</span><br><span class="line"> </span><br><span class="line">            return Task.CompletedTask;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>让我们看看如何管理客户端部分。例如，我们使用Angular CLI的<em>ng new SignalR</em>命令创建Angular应用程序。然后我们安装SignalR的包节点（<em>npm i @ aspnet / signalr</em>）。然后添加一个服务，该服务使我们可以连接到先前创建的集线器并接收消息。<br>在这里，第一种可能的方法是，基于服务getMessage（）中Observable <message>的服务，通过使用私有声明的Subject <message>来返回（Message是与从Object返回的对象相对应的Typescript接口。后端）：</message></message></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@Injectable(&#123;</span><br><span class="line"> providedIn: &apos;root&apos;</span><br><span class="line">&#125;)</span><br><span class="line">export class SignalRService &#123;</span><br><span class="line"> private message$: Subject&lt;message&gt;;</span><br><span class="line"> private connection: signalR.HubConnection;</span><br><span class="line"> </span><br><span class="line"> constructor() &#123;</span><br><span class="line">   this.message$ = new Subject&lt;message&gt;();</span><br><span class="line">   this.connection = new signalR.HubConnectionBuilder()</span><br><span class="line">   .withUrl(environment.hubUrl)</span><br><span class="line">   .build();</span><br><span class="line">   this.connect();</span><br><span class="line"> &#125;</span><br><span class="line"> private connect() &#123;</span><br><span class="line">   this.connection.start().catch(err =&gt; console.log(err));</span><br><span class="line">   this.connection.on(&apos;SendMessage&apos;, (message) =&gt; &#123;</span><br><span class="line">     this.message$.next(message);</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;</span><br><span class="line"> public getMessage(): Observable&lt;message&gt; &#123;</span><br><span class="line">   return this.message$.asObservable();</span><br><span class="line"> &#125;</span><br><span class="line"> public disconnect() &#123;</span><br><span class="line">   this.connection.stop();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在constructor（）内部，我们创建一个SignalR.HubConnection类型对象，该对象将用于连接到服务器。我们通过使用文件environment.ts将其传递到其中心URL：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">this.connection = new signalR.HubConnectionBuilder()</span><br><span class="line">   .withUrl(environment.hubUrl)</span><br><span class="line">   .build();</span><br></pre></td></tr></table></figure>

<p>构造函数还负责调用connect（）方法，该方法进行实际连接，并在控制台中记录可能的错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">this.connection.start().catch(err =&gt; console.log(err));</span><br><span class="line">this.connection.on(&apos;SendMessage&apos;, (message) =&gt; &#123;</span><br><span class="line">  this.message$.next(message);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>想要显示来自后端的消息的组件（将其注入到构造函数中的服务），应该订阅getMessage（）方法并管理到达的消息。以AppComponent为例，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Component(&#123;</span><br><span class="line"> selector: &apos;app-root&apos;,</span><br><span class="line"> templateUrl: &apos;./app.component.html&apos;,</span><br><span class="line"> styleUrls: [&apos;./app.component.css&apos;]</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent implements OnDestroy &#123;</span><br><span class="line"> private signalRSubscription: Subscription;</span><br><span class="line"> </span><br><span class="line"> public content: Message;</span><br><span class="line"> </span><br><span class="line"> constructor(private signalrService: SignalRService) &#123;</span><br><span class="line">   this.signalRSubscription = this.signalrService.getMessage().subscribe(</span><br><span class="line">     (message) =&gt; &#123;</span><br><span class="line">       this.content = message;</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;</span><br><span class="line"> ngOnDestroy(): void &#123;</span><br><span class="line">   this.signalrService.disconnect();</span><br><span class="line">   this.signalRSubscription.unsubscribe();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用主题<message>允许我们同时管理更多组件，而无论从中心返回的消息（用于订阅还是用于取消订阅）都可以，但是我们必须注意对主题的粗心使用。让我们考虑以下getMessage（）版本：</message></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public getMessage(): Observable&lt;message&gt; &#123;</span><br><span class="line">   return this.message$;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，该组件也可以使用以下简单代码发送一条消息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const produceMessage = this.signalrService.getMessage() as Subject&lt;any&gt;;</span><br><span class="line"> produceMessage.next( &#123;val1: &apos;a&apos;&#125;);</span><br><span class="line">&lt;/any&gt;</span><br></pre></td></tr></table></figure>

<p>如果方法getMessage（）返回Subject <message> asObservable，则此代码将引发异常！<br>我们可以在单个组件的情况下使用的第二种方法（更简单）对管理来自后端的消息感兴趣：</message></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">@Injectable(&#123;</span><br><span class="line"> providedIn: &apos;root&apos;</span><br><span class="line">&#125;)</span><br><span class="line">export class SignalrService &#123;</span><br><span class="line"> connection: signalR.HubConnection;</span><br><span class="line"> </span><br><span class="line"> constructor() &#123;</span><br><span class="line">   this.connection = new signalR.HubConnectionBuilder()</span><br><span class="line">   .withUrl(environment.hubAddress)</span><br><span class="line">   .build();</span><br><span class="line">   this.connect();</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> public connect() &#123;</span><br><span class="line">   if (this.connection.state === signalR.HubConnectionState.Disconnected) &#123;</span><br><span class="line">     this.connection.start().catch(err =&gt; console.log(err));</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> public getMessage(next) &#123;</span><br><span class="line">     this.connection.on(&apos;SendMessage&apos;, (message) =&gt; &#123;</span><br><span class="line">       next(message);</span><br><span class="line">     &#125;);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> public disconnect() &#123;</span><br><span class="line">   this.connection.stop();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以简单地将函数回调传递给方法getMessage，该函数将来自后端的消息作为参数。在这种情况下，AppComponent可以成为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public content: IMessage;</span><br><span class="line">constructor(private signalrService: SignalrService) &#123;</span><br><span class="line">   this.signalrService.getMessage(</span><br><span class="line">     (message: IMessage) =&gt; &#123;</span><br><span class="line">       this.content = message;</span><br><span class="line">     &#125;</span><br><span class="line">   );</span><br><span class="line">&#125;</span><br><span class="line">ngOnDestroy(): void &#123;</span><br><span class="line">   this.signalrService.disconnect();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后几行代码分别位于<em>app.component.html</em>和<em>app.component.css中</em>，以赋予一些时尚，并且该应用程序已完成。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=&quot;text-align:center&quot;&gt;</span><br><span class="line">  &lt;h1&gt;</span><br><span class="line">    DASHBOARD</span><br><span class="line">  &lt;/h1&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;card-container&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;card&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;h4&gt;&lt;b&gt;Valore 1&lt;/b&gt;&lt;/h4&gt;</span><br><span class="line">      &lt;p&gt;&#123;&#123;content.val1&#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;card&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;h4&gt;&lt;b&gt;Valore 2&lt;/b&gt;&lt;/h4&gt;</span><br><span class="line">      &lt;p&gt;&#123;&#123;content.val2&#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;card&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;h4&gt;&lt;b&gt;Valore 3&lt;/b&gt;&lt;/h4&gt;</span><br><span class="line">      &lt;p&gt;&#123;&#123;content.val3&#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;card&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;h4&gt;&lt;b&gt;Valore 4&lt;/b&gt;&lt;/h4&gt;</span><br><span class="line">      &lt;p&gt;&#123;&#123;content.val4&#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">.card-container &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-wrap: wrap;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">.card &#123;</span><br><span class="line">  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);</span><br><span class="line">  transition: 0.3s;</span><br><span class="line">  width: 40%;</span><br><span class="line">  flex-grow: 1;</span><br><span class="line">  margin: 10px;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">.card:hover &#123;</span><br><span class="line">  box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">.container &#123;</span><br><span class="line">  padding: 2px 16px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们首先启动后端，然后启动前端并检查最终结果：<br><img src="https://uploader.shimo.im/f/TJ3iFEnLIx8DuW8y.gif" alt="图片"></p>
<p>看起来不错！您可以在这里找到代码：<a href="https://github.com/AARNOLD87/SignalRWithAngular" target="_blank" rel="noopener">https</a> : <a href="https://github.com/AARNOLD87/SignalRWithAngular" target="_blank" rel="noopener">//github.com/AARNOLD87/SignalRWithAngular</a></p>
<p>下次见！</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://techq.xyz/2020/06/24/技术/how-to-use-abp-part1-basic-desc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="溪源">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者技术圈圈圈">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/06/24/技术/how-to-use-abp-part1-basic-desc/" class="post-title-link" itemprop="url">如何使用ABP进行软件开发（1）基础概览</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-24 20:05:00" itemprop="dateCreated datePublished" datetime="2020-06-24T20:05:00+08:00">2020-06-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-06-25 22:00:25" itemprop="dateModified" datetime="2020-06-25T22:00:25+08:00">2020-06-25</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ABP框架简述"><a href="#ABP框架简述" class="headerlink" title="ABP框架简述"></a>ABP框架简述</h1><h2 id="1）简介"><a href="#1）简介" class="headerlink" title="1）简介"></a>1）简介</h2><p>在.NET众多的技术框架中，ABP框架（本系列中指aspnetboilerplate项目）以其独特的魅力吸引了一群优秀开发者广泛的使用。</p>
<p>在该框架的赋能之下，开发者可根据需求通过官方网站【<a href="https://aspnetboilerplate.com/Templates" target="_blank" rel="noopener">https://aspnetboilerplate.com/Templates</a>】选择下载例如Vue/AngluarJS/MVC等不同类型的模板项目，轻松加入ABP开发者的队伍中，尽享基于ABP开发带来的乐趣。</p>
<p><img src="https://uploader.shimo.im/f/0I5mbgL5X2KWe3Ec.png!thumbnail" alt="图片"></p>
<p>ABP开发框架也提供了丰富的文档，能够为开发者带来许多便捷。目前ABP的文档网站为：</p>
<p>官方文档：<a href="https://aspnetboilerplate.com/Pages/Documents" target="_blank" rel="noopener">https://aspnetboilerplate.com/Pages/Documents</a></p>
<p>文档库不可谓不全，加上国内众多的ABP开发者参与的活跃的技术圈子，使得学习成本只是在第一个项目中比较高，后期将会越来越平滑。</p>
<h2 id="2）现状"><a href="#2）现状" class="headerlink" title="2）现状"></a>2）现状</h2><p>当然，目前ABP的框架开发者和社区已经把更多的精力投入到了ABP.VNEXT开发框架，这个新框架以其DDD+微服务+模块化的理念获得了大量拥趸，使ABP框架的开发优先级已经开始逐渐降低。</p>
<p>但这是因为ABP框架的功能已经成熟稳定，且ABP是一种增量式的架构设计，开发者在熟练掌握这种框架后，可以根据自己的需要进行方便的扩展，使其成为小项目架构选型中一种不错的备选方案。  </p>
<p>当然，也存在一些弊端。例如由于ABP被称为.NET众多开发框架中面向领域驱动设计的最佳实践，而囿于领域驱动设计本身不低的门槛，使得学习的过程变得看起来非常陡峭；</p>
<p>除此之外，ABP也广泛使用了目前Asp.NET/Asp.NET Core框架的大量比较新的特性，对于不少无法由于各种原因无法享受.NET技术飞速发展红利的传统开发者来说，无形中也提高了技术门槛。</p>
<h2 id="3）综述"><a href="#3）综述" class="headerlink" title="3）综述"></a>3）综述</h2><p>在这个系列中，本文计划分成三篇来介绍ABP框架，第一篇介绍ABP的基础概览，介绍基础知识，第二篇介绍ABP的模式实践，第三篇，试图介绍如何从更传统的三层甚至是单层+SQL的单层架构，如何迁移到ABP框架。</p>
<p>（毕竟。。.NET遗留应用实在是太多了，拯救或不拯救？）</p>
<h1 id="代码结构结构"><a href="#代码结构结构" class="headerlink" title="代码结构结构"></a>代码结构结构</h1><h2 id="基本文件夹简述"><a href="#基本文件夹简述" class="headerlink" title="基本文件夹简述"></a>基本文件夹简述</h2><p>当我们通过ABP模板项目的官方网站下载一个项目后，我们所获得的代码包的结构如下图所示，其中：</p>
<p><img src="https://uploader.shimo.im/f/Ju6P1J8FRkBtAhwt.png!thumbnail" alt="图片">)<img src="https://uploader.shimo.im/f/52c6ytXJo2RPq4U4.png!thumbnail" alt="图片"></p>
<ul>
<li>vue为使用iview框架构建的管理系统基本模板，该脚手架使用了yarn作为包管理器，并集成了vuex/axios等常用框架，并提供了用户，租户，权限三个基本功能的示例代码，开发者只需发挥聪明才智就能快速的通过该框架入手前端项目。</li>
<li>（当然，该项目广泛使用了typescript+面向对象的设计，似乎前端开发者。。普遍不擅长面向对象开发？）</li>
<li>aspnet-core则是一个完整的asp.netcore项目的快速开发脚手架。该脚手架集成了docker打包于一体，并包含基本的单元测试示例，使用了identity作为权限控制单元，使用swagger作为接口文档管理工具，集成了efcore、jwt等常用组件，对于开发者来说，基本上算是开箱即用了。<h1 id="前端vue项目"><a href="#前端vue项目" class="headerlink" title="前端vue项目"></a>前端vue项目</h1></li>
</ul>
<p>打开vue文件夹之后，该项目的基本目录如下图所示。（src文件夹）</p>
<p><img src="https://uploader.shimo.im/f/hjXiUSLWHrkFiSoI.png!thumbnail" alt="图片"></p>
<h3 id="lib文件夹"><a href="#lib文件夹" class="headerlink" title="lib文件夹"></a>lib文件夹</h3><p>定义了与abp+vue脚手架项目的基础组件和常见类库，封装了一系列基本方法。例如权限控制，数据请求，菜单操作，SignalR等基础组件的用法。</p>
<h3 id="router文件夹"><a href="#router文件夹" class="headerlink" title="router文件夹"></a>router文件夹</h3><p>定义了vue项目的路由规则，其中index.ts文件是项目的入口，router.ts文件定义了vue文件的路由规则。</p>
<h3 id="store文件夹"><a href="#store文件夹" class="headerlink" title="store文件夹"></a>store文件夹</h3><p>由于本项目使用了vuex框架，所以我们可以来看看对于store文件夹的介绍。</p>
<p>在vuex框架中：</p>
<blockquote>
<p>每一个 Vuex 应用的核心就是 store（仓库）。“store”基本上就是一个容器，它包含着你的应用中大部分的状态 (state)。<br>Vuex 和单纯的全局对象有以下两点不同：<br>Vuex 的状态存储是响应式的。当 Vue 组件从 store 中读取状态的时候，若 store 中的状态发生变化，那么相应的组件也会相应地得到高效更新。<br>你不能直接改变 store 中的状态。改变 store 中的状态的唯一途径就是显式地提交 (commit) mutation。这样使得我们可以方便地跟踪每一个状态的变化，从而让我们能够实现一些工具帮助我们更好地了解我们的应用。 </p>
</blockquote>
<p>即vuex框架中，将原来的请求链路，抽象化为状态的变化，通过维护状态，使得数据的管理更加便捷，也易于扩展。</p>
<h3 id="views文件夹"><a href="#views文件夹" class="headerlink" title="views文件夹"></a>views文件夹</h3><p>定义了登录、首页、用户、角色、租户的基本页面，并提供了新增、查看、编辑、删除的代码示例。</p>
<p>综上，该项目是一个结构清晰，逻辑缜密的前端框架，可以作为常见管理系统的脚手架。 </p>
<h1 id="后端项目"><a href="#后端项目" class="headerlink" title="后端项目"></a>后端项目</h1><p><img src="https://uploader.shimo.im/f/sMZQOoDFjlQgIJrW.png!thumbnail" alt="图片"></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>后端项目是一个遵循了领域驱动设计的分层，同时又符合Robert Martin在《代码整洁之道》提出的【整洁架构】。</p>
<p><img src="https://uploader.shimo.im/f/zYQDS5X0g86PUuIh.png!thumbnail" alt="图片"></p>
<h2 id="领域驱动设计简介"><a href="#领域驱动设计简介" class="headerlink" title="领域驱动设计简介"></a>领域驱动设计简介</h2><p>在领域驱动设计的分层设计中，共有四个功能分层，分别是：</p>
<p>表示层（Presentation Layer）：为用户提供接口，使用应用层实现用户交互。</p>
<p>应用层（Application Layer）：介于用户层和领域层之间，协调用户对象，完成对应的任务。</p>
<p>领域层（Domain Layer）：包含业务对象和规则，是应用程序的心脏。</p>
<p>基础设施层（Infrastructure Layer）：提供高层级的通用技术功能，主要使用第三方库完成。</p>
<p>在后文中，基于abp对领域驱动设计的功能分层将进行多次、详细叙述，本小节不再赘述。</p>
<h2 id="整洁架构简介"><a href="#整洁架构简介" class="headerlink" title="整洁架构简介"></a>整洁架构简介</h2><p>整洁架构是由Bob大叔提出的一种架构模型，来源于《整洁架构》这本书，顾名思义，其目的并不是为了介绍这一种优秀的架构本身，而是介绍如何设计一种整洁的架构，使得代码结构易于维护。</p>
<p><img src="https://uploader.shimo.im/f/C41YQfT1LaZ2qeLF.png!thumbnail" alt="图片"></p>
<p>（整洁架构就是这样一个洋葱，所以也有人称它为“洋葱”架构）</p>
<ol>
<li><strong>依赖规则(Dependency Rule)</strong></li>
</ol>
<p>用一组同心圆来表示软件的不同领域。一般来说，越深入代表你的软件层次越高。外圆是战术是实现机制(mechanisms)，内圆的是核心原则(policy)。</p>
<p>Policy means the application logic.</p>
<p>Mechanism means the domain primitives.</p>
<p>使此体系架构能够工作的关键是依赖规则。这条规则规定软件模块只能向内依赖，而里面的部分对外面的模块一无所知，也就是内部不依赖外部，而外部依赖内部。同样，在外面圈中使用的数据格式不应被内圈中使用，特别是如果这些数据格式是由外面一圈的框架生成的。我们不希望任何外圆的东西会影响内圈层</p>
<ol start="2">
<li><strong>实体 (Entities)</strong></li>
</ol>
<p>实体封装的是整个企业范围内的业务核心原则(policy)，一个实体能是一个带有方法的对象，或者是一系列数据结构和函数，只要这个实体能够被不同的应用程序使用即可。</p>
<p>如果你没有编写企业软件，只是编写简单的应用程序，这些实体就是应用的业务对象，它们封装着最普通的高级别业务规则，你不能希望这些实体对象被一个页面的分页导航功能改变，也不能被安全机制改变，操作实现层面的任何改变不能影响实体层，只有业务需求改变了才可以改变实体</p>
<ol start="3">
<li><strong>用例 (Use case)</strong></li>
</ol>
<p>在这个层的软件包含只和应用相关的业务规则，它封装和实现系统的所有用例，这些用例会混合各种来自实体的各种数据流程，并且指导这些实体使用企业规则来完成用例的功能目标。</p>
<p>我们并不期望改变这层会影响实体层. 我们也不期望这层被更外部如数据库 UI或普通框架影响，而这也正是我们分离出这一层来的原因所在。</p>
<p>然而，应用层面的操作改变将会影响到这个用例层，如果需求中用例发生改变，这个层的代码就会随之发生改变。所以可以看到，这一层是和应用本身紧密相关的</p>
<ol start="4">
<li><strong>接口适配器 (Interface Adapters)</strong></li>
</ol>
<p>这一层的软件基本都是一些适配器，主要用于将用例和实体中的数据转换为外部系统如数据库或Web使用的数据，在这个层次，可以包含一些GUI的MVC架构，表现视图 控制器都属于这个层，模型Model是从控制器传递到用例或从用例传递到视图的数据结构。</p>
<p>通常在这个层数据被转换，从用例和实体使用的数据格式转换到持久层框架使用的数据，主要是为了存储到数据库中，这个圈层的代码是一点和数据库没有任何关系，如果数据库是一个SQL数据库， 这个层限制使用SQL语句以及任何和数据库打交道的事情。</p>
<ol start="5">
<li><strong>框架和驱动器</strong></li>
</ol>
<p>最外面一圈通常是由一些框架和工具组成，如数据库Database, Web框架等. 通常你不必在这个层不必写太多代码，而是写些胶水性质的代码与内层进行粘结通讯。</p>
<p>这个层是细节所在，Web技术是细节，数据库是细节，我们将这些实现细节放在外面以免它们对我们的业务规则造成影响伤害</p>
<h2 id="ABP的分层实现"><a href="#ABP的分层实现" class="headerlink" title="ABP的分层实现"></a>ABP的分层实现</h2><p>在ABP项目中，层次划分如下。</p>
<ol>
<li>应用层（Application项目）</li>
</ol>
<p>在领域驱动设计的分层式架构中，应用层作为应用系统的北向网关，对外提供业务外观的功能。在Abp模板项目中,Application项目也是编写主要用例代码的位置，开发者们在此定义与界面有关的数据行为，实现面向接口的开发实践。</p>
<p><img src="https://uploader.shimo.im/f/0nBaITGior4zlqO1.png!thumbnail" alt="图片"></p>
<p>应用服务层包含应用服务，数据传输单元，工作单元等对象。</p>
<ul>
<li>Application Service</li>
</ul>
<p>为面向用户界面层实现业务逻辑代码。例如需要为某些界面对象组装模型，通常会定义ApplicationService，并通过DTO对象，实现与界面表现层的数据交换。</p>
<ul>
<li>Data Transfer Object (DTO)</li>
</ul>
<p>最常见的数据结构为DTO（数据传输对象），这是来源于马丁弗勒在《企业架构应用模式》中提到的名词，其主要作用为：</p>
<blockquote>
<p>是一种设计模式之间传输数据的软件应用系统。 数据传输目标往往是数据访问对象从数据库中检索数据。</p>
</blockquote>
<p>在ABP的设计中，有两种不同类型的DTO，分别是用于新增、修改、删除的Input DTO，和用于查询的Output DTO。</p>
<ul>
<li>Unit of Work：</li>
</ul>
<p>工作单元。工作单元与事务类似，封装了一系列原子级的数据库操作。  </p>
<ol start="2">
<li>核心层（Core项目）</li>
</ol>
<p>核心层包含领域实体、值对象、聚合根，以及领域上下文实现。</p>
<ul>
<li>Entity(实体）：</li>
</ul>
<p>实体有别于传统意义上大家所理解的与数据库字段一一匹配的实体模型，在领域驱动设计中,虽然实体同样可能持久化到数据库，但实体包含属性和行为两种不同的抽象。</p>
<p>例如，如果有一个实体为User，其中有一个属性为Phone，数据为086-132xxxxxxxx，我们有时需要判断该手机号码的国际代号，可能会添加一个新的判定 GetNationCode()，可以通过从Phone字段中取出086来实现，这就是一种通俗意义上的行为。</p>
<ul>
<li>Value Object（值对象）:</li>
</ul>
<p>值对象无需持久化到数据库，往往是从其他实体或聚合中“剥离”出来的与某些聚合具备逻辑相关性或语义相关性的对象，有时值对象甚至只有个别属性。</p>
<p>例如，上述实体，包含Phone字段，我们可以将整个Phone“剥离”为一个Telephone对象，该对象可包含PhoneNumber和NationCode字段。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class User</span><br><span class="line">&#123;</span><br><span class="line">     public Telephone Phone&#123;public get;private set;&#125;</span><br><span class="line">&#125;</span><br><span class="line">public class Telephone</span><br><span class="line">&#123;</span><br><span class="line">    public string  PhoneNumber &#123;get;set;&#125;</span><br><span class="line">     public string NationCode  &#123;get;set;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Aggregate &amp; Aggregate Root（聚合，聚合根）：</li>
</ul>
<p>聚合是业务的最小工作单元，有时，一个实体就是一个小聚合，而为聚合对外提供访问机制的对象，就是聚合根。</p>
<p>在领域驱动设计中，识别聚合也是一件非常重要的工作，有一组系统的方法论可以为我们提供参考。</p>
<p>当然，事实上识别领域对象，包括且不限定于识别聚合、值对象、实体识别该对象的行为或（方法）本身是一件需要经验完成的工作，有时需要UML建模方法的广泛参与。</p>
<p>有时，我们会习惯于通过属性赋值完成梭代码的过程，从而造成领域行为流失在业务逻辑层的问题，那么或许可以采取这样的方法：</p>
<p>1、对象的创建，使用构造函数赋值，或工厂方法创建。</p>
<p>2、将所有对于属性的访问级别都设置为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public string Phone&#123;public get;private set;&#125;</span><br></pre></td></tr></table></figure>

<p>然后再通过一个绑定手机号码的方法，来给这个对象设置手机号码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public string BindPhone(string phone)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将所有一切涉及到对Phone的操作，都只能通过规定的方法来赋值，这样可以实现我们开发过程中，无意识的通过属性赋值，可能导致的“领域行为”丢失的现象发生。<br>这种方式可以使得对对象某些属性的操作，只能通过唯一的入口完成，符合单一职责原则的合理运用，如果要扩展方法，可以使用开闭原则来解决。</p>
<p>但是，采用这种方式，得尽量避免出现：SetPhone(string phone) 这样的方法出现，毕竟这样的方法，其实和直接的属性赋值，没有任何区别。 </p>
<ul>
<li>Repository（仓储）</li>
</ul>
<p>仓储封装了一系列对象数据库操作的方法，完成对象从数据库到对象的转换过程。在领域驱动设计中，一个仓储往往会负责一个聚合对象从数据库到创建的全过程。</p>
<ul>
<li>Domain Service（领域服务）</li>
</ul>
<p>领域服务就是“实干家”，那些不适合在领域对象中出现，又不属于对象数据库操作的方法，又与领域对象息息相关的方法，都可以放到领域服务中实现。</p>
<ul>
<li>Specification（规格定义）</li>
</ul>
<p>规范模式是一种特殊的软件设计模式，通过使用布尔逻辑将业务规则链接在一起，可以重新组合业务规则。</p>
<p>实际上，它主要用于为实体或其他业务对象定义可重用的过滤器。</p>
<ol start="3">
<li>其他基础设施（EntityFrameworkCore，Web.Core,Web.Host项目)</li>
</ol>
<p>EntityFrameworkCore负责定义数据库上下文和对EFCore操作的一系列规则、例如种子数据的初始化等。</p>
<p><img src="https://uploader.shimo.im/f/D51RK39ZSnDFxvcz.png!thumbnail" alt="图片"></p>
<p>Web.Core：定义了应用程序的外观和接口。虽然从表面上看，Web.Core定义了作为Web访问入口的控制器方法和登录验证的逻辑，看起来像是用户表现层的东西，但是仔细想想，这些东西，何尝不是一种基础设施？</p>
<p>Web.Host：定义WEB应用程序的入口。 </p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>本文简述了ABP框架的前后端项目的分层结构，通过了解这些结构，将有助于我们在后续的实战中更快入手，为应用开发插上翅膀。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://techq.xyz/2020/06/09/技术/how-to-manage-user-secret-in-develop-and-production/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="溪源">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者技术圈圈圈">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/06/09/技术/how-to-manage-user-secret-in-develop-and-production/" class="post-title-link" itemprop="url">在Asp.NET Core中如何优雅的管理用户机密数据</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-09 20:05:00" itemprop="dateCreated datePublished" datetime="2020-06-09T20:05:00+08:00">2020-06-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-06-25 21:58:48" itemprop="dateModified" datetime="2020-06-25T21:58:48+08:00">2020-06-25</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="在Asp-NET-Core中如何优雅的管理用户机密数据"><a href="#在Asp-NET-Core中如何优雅的管理用户机密数据" class="headerlink" title="在Asp.NET Core中如何优雅的管理用户机密数据"></a>在Asp.NET Core中如何优雅的管理用户机密数据</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><h4 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h4><p>在软件开发过程中，使用配置文件来管理某些对应用程序运行中需要使用的参数是常见的作法。在早期VB/VB.NET时代，经常使用.ini文件来进行配置管理；而在.NET FX开发中，我们则倾向于使用web.config文件，通过配置appsetting的配置节来处理；而在.NET Core开发中，我们有了新的基于json格式的appsetting.json文件。</p>
<p>无论采用哪种方式，其实配置管理从来都是一件看起来简单，但影响非常深远的基础性工作。尤其是配置的安全性，贯穿应用程序的始终，如果没能做好安全性问题，极有可能会给系统带来不可控的风向。</p>
<h4 id="源代码比配置文件安全么？"><a href="#源代码比配置文件安全么？" class="headerlink" title="源代码比配置文件安全么？"></a>源代码比配置文件安全么？</h4><p>有人以为把配置存放在源代码中，可能比存放在明文的配置文件中似乎更安全，其实是“皇帝的新装”。</p>
<p>在前不久，笔者的一位朋友就跟我说了一段故事：他说一位同事在离职后，直接将曾经写过的一段代码上传到github的公共仓库，而这段代码中包含了某些涉及到原企业的机密数据，还好被github的安全机制提前发现而及时终止了该行为，否则后果不堪设想。</p>
<p>于是，笔者顺手查了一下由于有意或无意泄露企业机密，造成企业损失的案例，发现还真不少。例如<a href="https://www.infoq.cn/article/RZzfel1m6-h8pSK8TTC9" target="_blank" rel="noopener">大疆前员工通过 Github 泄露公司源代码，被罚 20 万、获刑半年</a>  这起案件，也是一个典型的案例。</p>
<p>该员工离职后，将包含关键配置信息的源代码上传到github的公共仓库，被黑客利用，使得大量用户私人数据被黑客获取，该前员工最终被刑拘。 <img src="https://static.geekbang.org/infoq/5cc32361f3500.png?imageView2/0/w/800" alt="大疆前员工通过Github泄露公司源代码，被罚20万、获刑半年"> </p>
<p> 图片来源：<a href="http://www.digitalmunition.com/WhyIWalkedFrom3k.pdf" target="_blank" rel="noopener"> http://www.digitalmunition.com/WhyIWalkedFrom3k.pdf</a> </p>
<p>大部分IT公司都会在入职前进行背景调查，而一旦有案底，可能就已经与许多IT公司无缘；即便是成为创业者，也可能面临无法跟很多正规企业合作的问题。</p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p>所以，安全性问题不容小觑，哪怕时间再忙，也不要急匆匆的就将数据库连接字符串或其他包含敏感信息的内容轻易的记录在源代码或配置文件中。在这个点上，一旦出现问题，往往都是非常严重的问题。</p>
<h2 id="如何实现"><a href="#如何实现" class="headerlink" title="如何实现"></a>如何实现</h2><p>在.NET FX时代，我们可以使用对web.config文件的关键配置节进行加密的方式，来保护我们的敏感信息，在.NET Core中，自然也有这些东西，接下来我将简述在开发环境和生产环境下不同的配置加密手段，希望能够给读者带来启迪。</p>
<h4 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h4><p>在开发环境下，我们可以使用visual studio 工具提供的用户机密管理器，只需0行代码，即可轻松完成关键配置节的处理。</p>
<h5 id="机密管理器概述"><a href="#机密管理器概述" class="headerlink" title="机密管理器概述"></a>机密管理器概述</h5><p>根据<a href="https://docs.microsoft.com/zh-cn/dotnet/architecture/microservices/secure-net-microservices-web-applications/developer-app-secrets-storage" target="_blank" rel="noopener">微软官方文档</a> 的描述：</p>
<blockquote>
<p>ASP.NET Core <a href="https://docs.microsoft.com/zh-cn/aspnet/core/security/app-secrets#secret-manager" target="_blank" rel="noopener">机密管理器</a>工具提供了开发过程中在源代码外部保存机密的另一种方法 。 若要使用机密管理器工具，请在项目文件中安装包 Microsoft.Extensions.Configuration.SecretManager 。 如果该依赖项存在并且已还原，则可以使用 <code>dotnet user-secrets</code> 命令来通过命令行设置机密的值。 这些机密将存储在用户配置文件目录中的 JSON 文件中（详细信息随操作系统而异），与源代码无关。</p>
<p>机密管理器工具设置的机密是由使用机密的项目的 <code>UserSecretsId</code> 属性组织的。 因此，必须确保在项目文件中设置 UserSecretsId 属性，如下面的代码片段所示。 默认值是 Visual Studio 分配的 GUID，但实际字符串并不重要，只要它在计算机中是唯一的。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">&gt;    <span class="tag">&lt;<span class="name">UserSecretsId</span>&gt;</span>UniqueIdentifyingString<span class="tag">&lt;/<span class="name">UserSecretsId</span>&gt;</span></span><br><span class="line">&gt; <span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span> </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>Secret Manager工具允许开发人员在开发ASP.NET Core应用程序期间存储和检索敏感数据。敏感数据存储在与应用程序源代码不同的位置。由于Secret Manager将秘密与源代码分开存储，因此敏感数据不会提交到源代码存储库。但机密管理器不会对存储的敏感数据进行加密，因此不应将其视为可信存储。敏感数据作为键值对存储在JSON文件中。最好<strong>不要</strong>在开发和测试环境中使用生产机密。<a href="https://nvisium.com/blog/2019/05/02/Dev-Secrets-and-the-ASP-NET-Core-Secret-Manager.html" target="_blank" rel="noopener">查看引文</a>。</p>
<h5 id="存放位置"><a href="#存放位置" class="headerlink" title="存放位置"></a>存放位置</h5><p>在windows平台下，机密数据的存放位置为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%APPDATA%\Microsoft\UserSecrets\\secrets.json</span><br></pre></td></tr></table></figure>

<p>而在Linux/MacOs平台下，机密数据的存放位置为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/.microsoft/usersecrets/&lt;user_secrets_id&gt;/secrets.json</span><br></pre></td></tr></table></figure>

<p> 在前面的文件路径中， ``将替换<code>UserSecretsId</code>为 <em>.csproj</em>文件中指定的值。 </p>
<h5 id="在Windows环境下使用机密管理器"><a href="#在Windows环境下使用机密管理器" class="headerlink" title="在Windows环境下使用机密管理器"></a>在Windows环境下使用机密管理器</h5><p>在windows下，如果使用Visual Studio2019作为主力开发环境，只需在项目右键单击，选择菜单【管理用户机密】，即可添加用户机密数据。   </p>
<p><img src="/images/how-to-manage-user-secret-in-develop-and-production_1.png" alt></p>
<p>在管理用户机密数据中，添加的配置信息和传统的配置信息没有任何区别。</p>
<blockquote>
<p>{<br>  “ConnectionStrings”: {<br>    “Default”: “Server=xxx;Database=xxx;User ID=xxx;Password=xxx;”<br>  }<br>}</p>
</blockquote>
<p>我们同样也可以使用IConfiguration的方式、IOptions<t>的方式，进行配置的访问。</t></p>
<h5 id="在非Windows-非Visual-Studio环境下使用机密管理器"><a href="#在非Windows-非Visual-Studio环境下使用机密管理器" class="headerlink" title="在非Windows/非Visual Studio环境下使用机密管理器"></a>在非Windows/非Visual Studio环境下使用机密管理器</h5><p>完成安装dotnet-cli后，在控制台输入 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet user-secrets init</span><br></pre></td></tr></table></figure>

<p> 前面的命令将在<code>UserSecretsId</code> .csproj 文件的<code>PropertyGroup</code>中添加 <em>.csproj</em>一个元素。 <code>UserSecretsId</code>是对项目是唯一的Guid值。 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">TargetFramework</span>&gt;</span>netcoreapp3.1<span class="tag">&lt;/<span class="name">TargetFramework</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">UserSecretsId</span>&gt;</span>79a3edd0-2092-40a2-a04d-dcb46d5ca9ed<span class="tag">&lt;/<span class="name">UserSecretsId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>设置机密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet user-secrets set &quot;Movies:ServiceApiKey&quot; &quot;12345&quot;</span><br></pre></td></tr></table></figure>

<p>列出机密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet user-secrets list</span><br></pre></td></tr></table></figure>

<p>删除机密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet user-secrets remove &quot;Movies:ConnectionString&quot;</span><br></pre></td></tr></table></figure>

<p>清除所有机密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet user-secrets clear</span><br></pre></td></tr></table></figure>

<h4 id="生产环境"><a href="#生产环境" class="headerlink" title="生产环境"></a>生产环境</h4><p>机密管理器为开发者在开发环境下提供了一种保留机密数据的方法，但在开发环境下是不建议使用的，如果想在生产环境下，对机密数据进行保存该怎么办？</p>
<p>按照微软官方文档的说法，推荐使用<a href="https://docs.microsoft.com/zh-cn/dotnet/architecture/microservices/secure-net-microservices-web-applications/azure-key-vault-protects-secrets" target="_blank" rel="noopener">Azure Key Vault </a> 来保护机密数据，但。。我不是贵云的用户（当然，买不起贵云不是贵云太贵，而是我个人的问题[手动狗头]）。</p>
<p>其次，与Azure Key Valut类似的套件，例如其他云，差不多都有，所以都可以为我们所用。</p>
<p>但。。如果您如果跟我一样，不想通过第三方依赖的形式来解决这个问题，那不如就用最简单的办法，例如AES加密。</p>
<h5 id="使用AES加密配置节"><a href="#使用AES加密配置节" class="headerlink" title="使用AES加密配置节"></a>使用AES加密配置节</h5><p>该方法与平时使用AES对字符串进行加密和解密的方法并无区别，此处从略。  </p>
<h5 id="使用数据保护Api（DataProtect-Api实现）"><a href="#使用数据保护Api（DataProtect-Api实现）" class="headerlink" title="使用数据保护Api（DataProtect Api实现）"></a>使用数据保护Api（DataProtect Api实现）</h5><p>在平时开发过程中，能够动手撸AES加密是一种非常好的习惯，而微软官方提供的数据保护API则将这个过程进一步简化，只需调Api即可完成相应的数据加密操作。</p>
<p>关于数据保护api， <a href="https://home.cnblogs.com/u/savorboard/" target="_blank" rel="noopener">Savorboard</a> 大佬曾经写过3篇博客讨论这个技术问题，大家可以参考下面的文章来获取信息。</p>
<p><a href="https://www.cnblogs.com/savorboard/p/dotnetcore-data-protection.html" target="_blank" rel="noopener">ASP.NET Core 数据保护（Data Protection 集群场景）【上】</a></p>
<p><a href="https://www.cnblogs.com/savorboard/p/dotnet-core-data-protection.html" target="_blank" rel="noopener">ASP.NET Core 数据保护（Data Protection 集群场景）【中】</a></p>
<p><a href="https://www.cnblogs.com/savorboard/p/dotnetcore-data-protected-farm.html" target="_blank" rel="noopener">ASP.NET Core 数据保护（Data Protection 集群场景）【下】</a></p>
<p>(接下来我要贴代码了，如果没兴趣，请出门左拐，代码不能完整运行，<a href="https://stackoverflow.com/questions/36062670/encrypted-configuration-in-asp-net-core" target="_blank" rel="noopener">查看代码</a>）</p>
<p>首先，注入配置项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public static IServiceCollection AddProtectedConfiguration(this IServiceCollection services, string directory)</span><br><span class="line">       &#123;</span><br><span class="line">           services</span><br><span class="line">               .AddDataProtection()</span><br><span class="line">               .PersistKeysToFileSystem(new DirectoryInfo(directory))</span><br><span class="line">               .UseCustomCryptographicAlgorithms(new ManagedAuthenticatedEncryptorConfiguration</span><br><span class="line">               &#123;</span><br><span class="line">                   EncryptionAlgorithmType = typeof(Aes),</span><br><span class="line">                   EncryptionAlgorithmKeySize = 256,</span><br><span class="line">                   ValidationAlgorithmType = typeof(HMACSHA256)</span><br><span class="line">               &#125;);</span><br><span class="line">           ;</span><br><span class="line"></span><br><span class="line">           return services;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<p>其次，实现对配置节的加/解密。（使用AES算法的数据保护机制）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class ProtectedConfigurationSection : IConfigurationSection</span><br><span class="line">    &#123;</span><br><span class="line">        private readonly IDataProtectionProvider _dataProtectionProvider;</span><br><span class="line">        private readonly IConfigurationSection _section;</span><br><span class="line">        private readonly Lazy&lt;IDataProtector&gt; _protector;</span><br><span class="line"></span><br><span class="line">        public ProtectedConfigurationSection(</span><br><span class="line">            IDataProtectionProvider dataProtectionProvider,</span><br><span class="line">            IConfigurationSection section)</span><br><span class="line">        &#123;</span><br><span class="line">            _dataProtectionProvider = dataProtectionProvider;</span><br><span class="line">            _section = section;</span><br><span class="line"></span><br><span class="line">            _protector = new Lazy&lt;IDataProtector&gt;(() =&gt; dataProtectionProvider.CreateProtector(section.Path));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public IConfigurationSection GetSection(string key)</span><br><span class="line">        &#123;</span><br><span class="line">            return new ProtectedConfigurationSection(_dataProtectionProvider, _section.GetSection(key));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public IEnumerable&lt;IConfigurationSection&gt; GetChildren()</span><br><span class="line">        &#123;</span><br><span class="line">            return _section.GetChildren()</span><br><span class="line">                .Select(x =&gt; new ProtectedConfigurationSection(_dataProtectionProvider, x));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public IChangeToken GetReloadToken()</span><br><span class="line">        &#123;</span><br><span class="line">            return _section.GetReloadToken();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public string this[string key]</span><br><span class="line">        &#123;</span><br><span class="line">            get =&gt; GetProtectedValue(_section[key]);</span><br><span class="line">            set =&gt; _section[key] = _protector.Value.Protect(value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public string Key =&gt; _section.Key;</span><br><span class="line">        public string Path =&gt; _section.Path;</span><br><span class="line"></span><br><span class="line">        public string Value</span><br><span class="line">        &#123;</span><br><span class="line">            get =&gt; GetProtectedValue(_section.Value);</span><br><span class="line">            set =&gt; _section.Value = _protector.Value.Protect(value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private string GetProtectedValue(string value)</span><br><span class="line">        &#123;</span><br><span class="line">            if (value == null)</span><br><span class="line">                return null;</span><br><span class="line"></span><br><span class="line">            return _protector.Value.Unprotect(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>再次，在使用前，先将待加密的字符串转换成BASE64纯文本，然后再使用数据保护API对数据进行处理，得到处理后的字符串。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private readonly IDataProtectionProvider _dataProtectorTokenProvider;</span><br><span class="line">public TokenAuthController( IDataProtectionProvider dataProtectorTokenProvider)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">[Route(&quot;encrypt&quot;), HttpGet, HttpPost]</span><br><span class="line">public string Encrypt(string section, string value)</span><br><span class="line">&#123;</span><br><span class="line">     var protector = _dataProtectorTokenProvider.CreateProtector(section);</span><br><span class="line">     return protector.Protect(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再替换配置文件中的对应内容。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"ConnectionStrings"</span>: &#123;</span><br><span class="line">    <span class="attr">"Default"</span>: <span class="string">"此处是加密后的字符串"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们就可以按照平时获取IOptions<connectstrings>的方式来获取了。</connectstrings></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>公众号【DotNET骚操作】号主【周杰】同学提出以下观点：</p>
<p><strong>1、在生产环境下，使用AES加密，其实依然是一种不够安全的行为，充其量也就能忽悠下产品经理，毕竟几条简单的语句，就能把机密数据dump出来。</strong></p>
<p> 也许在这种情况下，我们应该优先考虑accessKeyId/accessSecret，尽量通过设置多级子账号，通过授权Api的机制来管理机密数据，而不是直接暴露类似于数据库连接字符串这样的关键配置信息。另外，应该定期更换数据库的密码，尽量将类似的问题可能造成的风险降到最低。数据保护api也提供的类似的机制，使得开发者能够轻松的管理机密数据的时效性问题。</p>
<p><strong>2、配置文件放到CI/CD中，发布的时候在CI/CD中进行组装，然后运维只是负责管理CI/CD的账户信息，而最高机密数据，则由其他人负责配置。</strong></p>
<p>嗯，我完全同意他的第二种做法，另外考虑到由于运维同样有可能会有意无意泄露机密数据，所以如果再给运维配备一本《刑法》，并让他日常补习【侵犯商业秘密罪】相关条款，这个流程就更加闭环了。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>本文简述了在.NET Core中，如何在开发环境下使用用户机密管理器、在生产环境下使用AES+IDataProvider的方式来保护我们的用户敏感数据。由于时间仓促，如有考虑不周之处，还请各位大佬批评指正。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://techq.xyz/2020/05/28/技术/C＃性能提示和技巧/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="溪源">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者技术圈圈圈">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/05/28/技术/C＃性能提示和技巧/" class="post-title-link" itemprop="url">C＃提升性能的几点提示和技巧</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-05-28 20:05:00" itemprop="dateCreated datePublished" datetime="2020-05-28T20:05:00+08:00">2020-05-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-06-25 22:01:00" itemprop="dateModified" datetime="2020-06-25T22:01:00+08:00">2020-06-25</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="C＃性能提示和技巧"><a href="#C＃性能提示和技巧" class="headerlink" title="C＃性能提示和技巧"></a>C＃性能提示和技巧</h1><p>在<a href="https://raygun.com/" target="_blank" rel="noopener">Raygun</a>，我们是一群非常懂多种语言的开发人员。Raygun的各个部分使用不同的语言和框架编写-最好的工作方式。</p>
<p>鉴于大量的C＃和我们正在处理的数据的爆炸性增长，在不同的时间需要进行一些优化工作。大部分重大的收获往往来自于真正地重新思考问题并从全新的角度解决问题。</p>
<p>今天我想分享一些C＃性能技巧，这些技巧对我的最新工作有所帮助。其中一些功能在你看来也许相当微不足道，因此请不要在这里充电并使用所有功能。就这样，提示1是…</p>
<h2 id="1-每个开发人员都应使用分析器"><a href="#1-每个开发人员都应使用分析器" class="headerlink" title="1.每个开发人员都应使用分析器"></a>1.每个开发人员都应使用分析器</h2><p>有一些很棒的.NET分析器。我个人使用了<a href="https://www.jetbrains.com/" target="_blank" rel="noopener">Jet Brains</a>团队的dotTrace分析器。我知道我们团队中的Jason 也从<a href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/" target="_blank" rel="noopener">Red Gate分析器中</a>获得了很多价值。每个开发人员都应安装<strong>并使用</strong>探查器。</p>
<p>我无法数出我<strong>认为</strong>应用程序的最慢部分在一个区域中的次数，而实际上却完全在其他地方。探查器对此提供了帮助。此外，有时候，它可以帮助我发现错误-缓慢的部分之所以缓慢，只是因为它做错了什么（单元测试<em>没有</em>正确地拾取它）。</p>
<p>这是您要执行的所有优化工作的第一步，也是有效的第一步。</p>
<p> <img src="https://raygun.com/blog/images/c-sharp-performance/image1.jpg" alt="冲刺开始"> </p>
<h2 id="2-级别越高，速度越慢（通常）"><a href="#2-级别越高，速度越慢（通常）" class="headerlink" title="2.级别越高，速度越慢（通常）"></a>2.级别越高，速度越慢（通常）</h2><p>这只是我闻到的气味。您使用的抽象级别越高，通常越慢。我在这里发现的一个常见示例是在代码繁忙的部分（也许在循环中被称为数百万次）中使用LINQ。LINQ非常适合快速表达某些内容，而这些内容可能要花一堆代码，但是您通常会将性能留在桌面上。</p>
<p>不要误会我的意思-LINQ非常适合让您开发出可运行的应用程序。但是在代码库中以性能为中心的部分中，您可能会付出太多。特别是因为将这么多操作链接在一起非常容易。</p>
<p>我所使用的特定示例是我使用的地方<code>.SelectMany().Distinct().Count()</code>。鉴于这被称为数千万次（由我的探查器发现的关键热点），它正在累积大量的运行时间。我采用了另一种方法，并将执行时间减少了几个数量级。</p>
<h2 id="3-不要低估发行版和调试版"><a href="#3-不要低估发行版和调试版" class="headerlink" title="3.不要低估发行版和调试版"></a>3.不要低估发行版和调试版</h2><p>我一直在努力工作，对获得的性能感到非常满意。然后，我意识到自己已经在Visual Studio中进行了所有测试（我经常将性能测试编写为也可以作为单元测试运行，因此我可以更轻松地运行自己关心的部分）。我们都知道发行版本已启用优化。</p>
<p>因此，我做了一个发布版本，称为从控制台应用程序测试的方法。</p>
<p>我对此有了很大的转变。我的代码已经疯狂地进行了优化，因此确实是时候对.NET JIT编译器进行一些微优化了。启用优化后，我的性能提高了约30％！这使我想起了我不久前在网上阅读的一个故事。</p>
<p><img src="https://raygun.com/blog/images/c-sharp-performance/image3.png" alt="软盘的屏幕截图"></p>
<p>这是上世纪90年代的一个古老游戏编程故事，当时内存限制非常严格。在开发周期的后期，团队最终将耗尽内存，并开始考虑必须删除或降级哪些内容以适合可用的微小内存空间。资深开发人员根据他的经验就曾期望这样做，并在项目一开始就分配了1MB的内存和垃圾数据。然后，他节省了一天的时间，并删除了他在项目开始时立即分配的1MB内存，从而解决了问题！</p>
<p>知道团队总是没有足够的空间，因为那里有可用的内存，就可以为团队提供他们所需要的东西，并按时发货。</p>
<p>我为什么要分享这个？在性能方面类似–在调试模式下获得足够好的运行，并且您将在发行版本中获得一些“免费”性能。美好时光。</p>
<h2 id="4-看大局"><a href="#4-看大局" class="headerlink" title="4.看大局"></a>4.看大局</h2><p>有一些很棒的算法。您多数不需要每天甚至每月都不用。但是，值得知道它们的存在。我经常进行研究后，就会发现一种更好的解决问题的方法。在编码之前进行研究的开发人员与在编写代码之前进行适当分析的开发人员的可能性差不多。我们喜欢代码，并且总是想直接进入IDE。</p>
<p>此外，通常在查看性能问题时，我们过于专注于单个生产线或方法。这可能是一个错误–放眼全局，可以通过减少需要完成的工作来帮助您显着提高性能。</p>
<h2 id="5-内存位置很重要"><a href="#5-内存位置很重要" class="headerlink" title="5.内存位置很重要"></a>5.内存位置很重要</h2><p>假设我们有一个数组数组。实际上是一张桌子，尺寸为3000×3000。我们要计算有多少个插槽的值大于零。</p>
<p>问题–这两个中哪个更快？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">for (int i = 0; i &lt; _map.Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">	for (int n = 0; n &lt; _map.Length; n++)</span><br><span class="line">	&#123;</span><br><span class="line">  		if (_map[i][n] &gt; 0)</span><br><span class="line">  		&#123;</span><br><span class="line">    	    result++;</span><br><span class="line">  		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">for (int i = 0; i &lt; _map.Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">	for (int n = 0; n &lt; _map.Length; n++)</span><br><span class="line">	&#123;</span><br><span class="line">  		if (_map[n][i] &gt; 0)</span><br><span class="line">  		&#123;</span><br><span class="line">    	    result++;</span><br><span class="line">  		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>回答？第一个。 在我的测试中，此循环使性能提高了8倍！</p>
<p>注意区别吗？这是我们遍历此数组数组的顺序（[i] [n]与[n] [i]）。即使我们从自己管理内存中抽象出来，内存局部性在.NET中的确很重要。</p>
<p>就我而言，这种方法被称为数百万次（准确地说是数亿次），因此我可以从中获得的任何性能都获得了可观的胜利。再次感谢我经常使用的分析器，以确保我专注于正确的地方！</p>
<h2 id="6-减轻垃圾收集器的压力"><a href="#6-减轻垃圾收集器的压力" class="headerlink" title="6.减轻垃圾收集器的压力"></a>6.减轻垃圾收集器的压力</h2><p>C＃/.NET具有垃圾回收功能。垃圾收集是确定哪些对象当前已过时并删除它们以释放内存中空间的过程。这意味着在C＃中，与C ++之类的语言不同，您不必手动维护不再有用的对象的删除，即可声明其在内存中的空间。相反，垃圾收集器（GC）处理所有这些，因此您不必这样做。</p>
<blockquote>
<p>问题是没有免费的午餐</p>
</blockquote>
<p>问题是没有免费的午餐。收集过程本身会导致性能下降，因此您实际上并不希望GC一直收集。那么如何避免这种情况呢？</p>
<p>有<a href="https://michaelscodingspot.com/avoid-gc-pressure/" target="_blank" rel="noopener">许多有用的技术可以避免对GC施加太大压力</a>。在这里，我将只关注一个技巧：避免不必要的分配。这意味着要避免这样的事情：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Product&gt; products = new List&lt;Product&gt;();</span><br><span class="line">products = productRepo.All();</span><br></pre></td></tr></table></figure>

<p>第一行创建了一个完全无用的列表实例，因为下一行返回另一个实例并将其引用分配给变量。现在想象一下上面的两行是否在一个执行数千次的循环中？</p>
<p>上面的代码可能看起来像一个愚蠢的示例，但是我已经在生产中看到了这样的代码，而不仅仅是一次。不要只关注示例本身，而要关注一般建议。除非确实需要，否则不要创建对象。</p>
<p>由于GC在.NET中的工作方式（这是一个世代的GC流程），因此较旧的对象更有可能收集较新的对象。这意味着创建许多新的，短暂的对象可能会触发GC运行。</p>
<h2 id="7-不要使用空的析构函数"><a href="#7-不要使用空的析构函数" class="headerlink" title="7.不要使用空的析构函数"></a>7.不要使用空的析构函数</h2><p>标题说明了一切-请勿在类中添加空的析构函数。<code>Finalize</code>每个具有析构函数的类的条目都会添加到队列中。然后在调用析构函数时调用我们的老朋友GC来处理队列。空的析构函数意味着这一切都是徒劳的。</p>
<p>请记住，就性能而言，GC执行并不便宜，正如我们已经提到的。不要不必要地导致GC工作。</p>
<p><img src="https://raygun.com/blog/images/c-sharp-performance/image5.jpg" alt="盒子的屏幕截图"></p>
<h2 id="8-避免不必要的装箱和拆箱"><a href="#8-避免不必要的装箱和拆箱" class="headerlink" title="8.避免不必要的装箱和拆箱"></a>8.避免不必要的装箱和拆箱</h2><p>装箱和拆箱就像垃圾回收一样，在性能方面很昂贵。因此，我们希望避免不必要地进行操作。但是他们在实践中会做什么？</p>
<p>装箱就像创建引用类型框并将值类型的值放入其中一样。换句话说，它包括将值类型转换为“对象”或该值类型实现的接口类型。取消装箱相反，它会打开包装盒并从其中提取值类型。为什么会有问题呢？</p>
<p>好吧，正如我们已经提到的，装箱和拆箱本身就是昂贵的过程。除此之外，当您装箱一个值时，您会在堆上创建另一个对象，这给GC带来了额外的压力（您已经猜到了！）。</p>
<p>那么，如何避免装箱和拆箱呢？</p>
<p>通常，您可以通过避免.NET（版本1.0）中早于泛型的API来做到这一点，因此，它们必须依赖于使用对象类型。例如，更喜欢通用集合，例如<code>System.Collections.Generic.List</code>，而不是<code>System.Collections.ArrayList</code>。</p>
<h2 id="9-当心字符串连接"><a href="#9-当心字符串连接" class="headerlink" title="9.当心字符串连接"></a>9.当心字符串连接</h2><p>在C＃/。NET中，字符串是不可变的。因此，每次执行一些看起来好像在更改字符串的操作时，它们都会创建一个新的字符串。这些操作包括类似的方法<code>Replace</code>和<code>Substring</code>，同时也串联。</p>
<blockquote>
<p>提防串联大量字符串，尤其是在循环内部</p>
</blockquote>
<p>因此，这里的技巧很简单-注意不要串联大量字符串，尤其是在循环内部。在这种情况下，请使用<code>System.Text.StringBuilder</code>类，而不要使用“ +”运算符。这样可以确保不会为连接的每个部分创建新实例。</p>
<h2 id="10-随时关注C＃的发展"><a href="#10-随时关注C＃的发展" class="headerlink" title="10.随时关注C＃的发展"></a>10.随时关注C＃的发展</h2><p>最后，我们以非常笼统的建议作为结尾-请密切关注C＃语言的更改和发展方式。C＃团队不断提供可以对性能产生积极影响的新功能。</p>
<p>我们可以提到的一个最新示例是C＃7中引入的<a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/ref-returns" target="_blank" rel="noopener">ref</a> return <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/ref-returns" target="_blank" rel="noopener">和ref locals</a>。这些新功能允许开发人员按引用返回并将引用存储在局部变量中。C＃7.2引入了<a href="https://docs.microsoft.com/en-us/dotnet/api/system.span-1?view=netcore-3.0" target="_blank" rel="noopener">Span</a> 类型，从而可以对内存的连续区域进行类型安全的访问。</p>
<p>诸如此类的新功能和类型不太可能被大多数C＃开发人员使用，但是它们无疑会对性能至关重要的应用程序产生影响，值得进一步了解。</p>
<h2 id="C＃性能很重要！"><a href="#C＃性能很重要！" class="headerlink" title="C＃性能很重要！"></a>C＃性能很重要！</h2><p>这只是我发现对提高.NET代码性能有用的几件事的集合-但是值得花时间检查代码以确保其性能。您的团队和客户将感谢您！</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://techq.xyz/2020/05/26/管理/我是如何完成一个短期项目的？/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="溪源">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者技术圈圈圈">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/05/26/管理/我是如何完成一个短期项目的？/" class="post-title-link" itemprop="url">我是如何完成一个短期项目的？</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-05-26 22:28:00 / Modified: 19:35:39" itemprop="dateCreated datePublished" datetime="2020-05-26T22:28:00+08:00">2020-05-26</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/随笔/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>项目启动</li>
</ol>
<p>4月中旬，接到指示，需要于5月10日完成一个紧急任务，这个项目是为一位核心客户打造一套具备公众号，后台和大屏显示系统相关的完整系统，而此时，我们的团队构建还并没有完成，意味着我们需要实现的将是一个超出现有团队实际能力的项目。</p>
<p>当然，团队能力本身衡量就是一件并不容易的事情。如同从海绵中挤水分，也许从表面上看没什么内容，但挤一挤总能挤出许多精华来，尤其是在职场中成长，总必须经历一番考验，把自己的潜力逼出来，才能真正成长。</p>
<p>当然，我依然根据实际情况进行了一番风险评估，主要包括一下几个方面：</p>
<p>1，团队资源匮乏，尤其是缺乏有经验的开发者</p>
<p>2，大华摄像头以前没对接过，存在技术的不确定性。</p>
<p>3，团队没搞过公众号开发。</p>
<p>4，时间太紧，质量可能是个问题，有可能影响公司商誉。等会，</p>
<p>显然，风险评估是项目启动前必须做好的关键。尤其是这个项目，承载着相关方的许多目标，包括是我们团队的第一个正式项目，无论是老板也好，公司同事也好，甚至加入团队的成员们也好，其实都想知道我们这个团队到底行不行，能不能承受足够的压力。</p>
<p>显然，团队成员们都需要通过这个项目证明自己的能力，进而证明团队的能力。</p>
<h1 id="二-技术选型"><a href="#二-技术选型" class="headerlink" title="二 技术选型"></a>二 技术选型</h1><p>在完成项目启动会后，我们跟客户进行了一番沟通，明确了项目团队中大家关心的问题，并开始着手技术选型，框架，业务分析，代码实现。</p>
<p>在进行技术选型中，我基于公司长期积累的角度，选择了.netcore+vue.js的组合型技术栈，框架使用了abp作为我们的开发框架。</p>
<p>虽然在实际过程中，有人提出了abp开发框架提供了一系列重量级的组件，对我们这样的团队来说可能会扩大技术风险，平白增加项目的时间。但实际过程中，该选型并没有造成想象中那么严重的问题。主要原因大概有以下几点：</p>
<p>1，abp无论如何依然是.net技术栈中最受欢迎，公认设计最优雅的面向领域驱动设计的框架。哪怕我们不用领域驱动的思想，也不影响我们使用abp的轮子。它的轮子确实太灵活方便了，运用妥当定然能给我们带来不少好处。</p>
<p>2，即使我已经从事了十年开发，却依然觉得要设计一套权限认证系统远比想象中的复杂。</p>
<p>事实上这是一个普遍认可的观点，看起来权限认证几个表就能搞定这个问题，其实并非如此。例如abp的权限认证包括了如下复杂的逻辑结构。</p>
<p><img src="https://images.smcdn.cn/AJeFAPstbzMWiy3R/IMG_1783.JPG!thumbnail" alt="图片"><br>在介绍领域驱动设计的一本书《Microsoft.Net企业级应用架构设计》这本书中，作者也表达了同样的观点：</p>
<p>即使已经写了多本asp.net的书，创建基于角色的UI基础设施以及相关的成员系统耗费比预期更多的功夫。</p>
<p>事实上，对于我们这样的项目，关键不是选什么框架，而是选一种能够满足当前需求，又能在未来给公司带来积累的框架和技术体系，而abp和abpvnext恰好如此。小项目可以用abp，大项目则可以考虑后者。或者都可以采用后者。</p>
<h1 id="三，项目过程控制"><a href="#三，项目过程控制" class="headerlink" title="三，项目过程控制"></a>三，项目过程控制</h1><p>当这个项目拿到时，我们面临短期看似无法完成的较多量需求，难免会存在选择困难证。究竟是做A，还是选B，还是做一个成年人应该选的，两者都选？</p>
<p>显然，我们的精力有限，只能有所取舍。</p>
<p>在现代软件工程中，瀑布模型，快速原型开发模型，增量/迭代型模型都是我们在项目选型过程最基础的选择。如果采用瀑布模型，显然不符合我们的实际情况，因为没有足够的资源，不太可能花时间写文档；快速原型也同样如此，花时间做一个完整的demo，那也不太可行，尤其是甲方已经确定了原型之后，已经具备开发实例功能的前提。</p>
<p>在这个模块优先级选择之中，我个人认为，虽然B端系统这个部分需求很多，优先把它搞定，能够让我们集中精力解决其他问题，但对用户来说，是否真的如此？</p>
<p>业务价值的评估是我们进行功能优先级评定的第一要素。如同一个价值滑条，同时摆在一个刻度上，永远只有一个功能。</p>
<p>于是，我们将公众号，大屏作为第一迭代。并安排足够的资源优先完成此模块。当然，资源其实依然并不足够，但大家都知道，资源不足才是项目最普遍的现象，在现有资源范围充分利用，才是成立项目组的目的。</p>
<p>我们引入了持续集成的概念，要求把更早的交付当作核心目的。为了实现这个目标，我们采取了如下措施：</p>
<ol>
<li><p>收集需求，以低保真原型图指导软件开发，除个别页面要求美观外，其他页面以满足可用性为准</p>
</li>
<li><p>前后端设计模拟数据，前端就可以开始联调了。</p>
</li>
<li><p>划分迭代周期，确定发布节奏。</p>
</li>
<li><p>UI先行开发，同步后端开始设计接口和模拟数据的格式，用后端不用直接与前端联调，而是使用测试驱动先行的方式开发后台逻辑。 </p>
</li>
</ol>
<h1 id="四，总结"><a href="#四，总结" class="headerlink" title="四，总结"></a>四，总结</h1><p>当然在实际操作过程中，我们并没有采用测试驱动开发的红绿重构开发实践，这使得我们没有足够的保障措施来确保代码质量，而且由于项目团队普遍经验不足，也意味着我们在未来的演进过程中，将面临许多严重问题。</p>
<p>在这个项目中，我们采用了合理的迭代划分；让售前，设计驻场确保需求的澄清；采用了开发分支和功能分支分离的模式是我个人认为值得复用的经验。</p>
<p>由于时间缘故，在下一篇文章中，再讨论一下这个问题。</p>
<h1 id><a href="#" class="headerlink" title></a></h1>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://techq.xyz/2020/05/18/随笔/共同创业五年，技术总监却突然就这么离职了/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="溪源">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者技术圈圈圈">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/05/18/随笔/共同创业五年，技术总监却突然就这么离职了/" class="post-title-link" itemprop="url">共同创业五年，技术总监却突然就这么离职了</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-05-18 16:28:00" itemprop="dateCreated datePublished" datetime="2020-05-18T16:28:00+08:00">2020-05-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-05-26 19:11:40" itemprop="dateModified" datetime="2020-05-26T19:11:40+08:00">2020-05-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/随笔/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一、-引子"><a href="#一、-引子" class="headerlink" title="一、 引子"></a>一、 引子</h1><p>有一天，跟一位原同事老A聊起职场的一些情况，期间无意中提到了原公司的技术总监。我说这位技术总监带领公司从一家十几人的小团队，做到四百人的公司，作为同样都是开发者，而且以前也都从事过相同行业的开发，我非常钦佩他。</p>
<p>在内地城市长沙，虽然也有一些优秀的互联网公司，但像这样短短五年，使公司从十几个人的公司发展为几百人的公司，组建起拥有200人的技术团队，其实已经算是非常不错了。</p>
<p>在公司这五年的发展过程中，这位技术总监应该是出力非常多的一位，从引入变革，到关键产品的发布，到团队的逐渐发展，到研发流程的规范化，已经算是一位适时刷新思想，实现组织变革的典型人物了。</p>
<p>当然，有时候公司发展得好，既是“时势造英雄”，又是“英雄造时势”。老板不能只说自己的功劳，把公司做的好，全归功于自己决策做得好、党和国家政策好，技术总监也不会自吹自擂，将不属于自己的功劳，也吹成自己的功劳。虽然这两位之间看起来似乎有点不太明显的矛盾，但总归是维持在一个平衡的程度，使得公司依然能够保持快速的发展速度，长此以往一定会成就一段佳话。</p>
<p>这时，老A却告诉我，这位技术总监过完年就已经从公司离职了。</p>
<p>这让我非常惊讶，干得好好的，怎么就离职了?这位技术总监和老板之间配合得还算默契，公司发展也处于“如日中天”的状态，怎么说走就走？</p>
<p>老板换人了？怎么可能，技术总监往往是公司最关键的技术岗位，怎么可能像普通开发岗位一样想换就换的。是不是有什么特殊的原因？</p>
<p>他说：这有什么，想走了呗。也许有哪些原因，我们也看不出来啊。</p>
<p>好吧，其实我也并非一位喜欢职场八卦的人，无意对深层次的原因进一步挖掘，尤其是这家公司纵使在长沙看起来有一点规模，但是在《架构师社区》的读者眼里，依然并非“大厂”，不提也罢。</p>
<p>总结来说，每个人职场都有不同的选择，在恰到好处的时候离去，无论是归于平淡，还是寻找另外一番人生际遇，或是快意恩仇，或是潇洒自如，或是相忘于江湖，都是对自己职场人生的一段总结。</p>
<h1 id="二、-技术总监，“高”处不胜寒"><a href="#二、-技术总监，“高”处不胜寒" class="headerlink" title="二、 技术总监，“高”处不胜寒"></a>二、 技术总监，“高”处不胜寒</h1><h2 id="1）"><a href="#1）" class="headerlink" title="1）"></a>1）</h2><p>在我刚刚参加工作时，曾经以为技术高管算是一位开发者职场奋斗的顶峰，能够成为技术高管，一定已经非常”稳定“了。</p>
<p>当然，这种观点显然已经过时了。读者们都非常清楚，在一家成熟的公司，理论上讲，没有一个人是不可替换的，唯一的区别是替换成本的高低。尤其是那些成熟的互联网公司，连企业法人也会根据公司发展形势的变化而变化，那技术总监就更不用说了。</p>
<p>技术总监甚至不一定属于“高管”，例如小公司，由于天花板很低，也许一位技术总监，已经算是“高管”了；但在大公司，其实很少会轻易将高管Title授予给他人，有时看上去那些所谓“总监”，其实只是头衔而已，并不能说明他的职位和话语权究竟有多高；也许得VP（技术合伙人）或CTO才能称为“高管”。</p>
<p>不过总体来说，从白手起家的普通程序员，到成为“技术总监”，这已经算是对一位辛勤工作的开发者付出的极大肯定了。</p>
<h2 id="2）"><a href="#2）" class="headerlink" title="2）"></a>2）</h2><p>但有朝一日成为了技术总监，就真的职场无忧了么？</p>
<p>并非如此，有一位朋友曾经分享了一个图片，那是一位40+的技术总监求职10k+技术职位的简历截图。（由于某些原因，不便分享。）</p>
<p>这位大佬在一家国企的IT技术部门担任技术总监，在公司期间曾经主导了公司从传统媒体到新媒体的转型，为公司寻找新的利益增长点做出了不可磨灭的贡献，但是由于新媒体市场的激烈竞争，即便是依托国企和政府的良好关系和资源，这家公司依然很难在这个市场获得不错的业绩。</p>
<p>业绩不好，技术部门自然而然也不会有多好过，事实上压力最大、首当其冲的就是技术老大，一方面是公司在新方向上的投入和产出不对等，首先就会追究技术总监的责任，另外一方面，研发团队长期承受巨大的压力，每天都加班加点，却被公司业务部门屡屡出言不逊，“花了那么多钱，结果养出来一支这样的卵蛋”？（毕竟虽然是国企吃大锅饭，但技术部门的工资，其实比业务部门要高出一倍有余），好不容易培养出来的团队，面临着严重的人员流失问题，又会让新项目的开展面临难以维系的局面。</p>
<p>曾几何时，这位技术总监试图在团队内营造一股生机盎然的学习氛围，让大家在轻松而又愉快的氛围中共同进步，但是来自于业务部门的压力，显然让一切试图制造象牙塔的努力都变成徒劳。</p>
<p>最终那些琳琅满目的书架、咖啡机、每日点心，被那些“大干一百天，奋斗就是生存”“年轻时不奋斗，还何时奋斗”“我的生命只有一次，我们要用他来改变世界”这样的标语替代。 </p>
<p>（这也让许多心心念念去国企、大厂寻求稳定的人提个醒，也许你还真寻不到你梦寐以求的稳定。）</p>
<h2 id="3）"><a href="#3）" class="headerlink" title="3）"></a>3）</h2><p>他曾经跟我讲过刚去公司时，老板给他描绘的一幅幅宏伟蓝图，在刚开始业务转型时，在公司的大力支持之下，一个个他主导的项目都比他自己预想的还要轻易的完成，在同事们眼中，俨然一幅救世主一般。</p>
<p>但是由于竞争对手过于强大，那些他带领几十号技术人员付出了许多个昼夜、熬夜加班干出来的新产品，却由于没办法获得足够的流量，最终如同一拳打到了棉花上，毫无产出。</p>
<p>然后两年过去，他已经不再看业务部门同事的眼光了，也许莫名其妙间，感受到的是一股“嫌隙”的表情。许多业务部门的同事甚至会当着他的面说，如果把投入到互联网产品上的大几百万拿给自己做业务，肯定能带来更多客户。</p>
<p>于是最终，这位技术总监也选择了放弃，他想回归本行，从一位纯粹的开发者干起，但大概市场已经没有他的位置了吧。</p>
<p>毕竟，在如今的长沙，企业老板们对40岁左右的开发者，不管你履历多么华丽，所能提供的薪酬待遇，往往不超过10k。</p>
<p>也许，他能选择的方向，是“教职”。</p>
<h1 id="三-职业发展方向之谜"><a href="#三-职业发展方向之谜" class="headerlink" title="三 职业发展方向之谜"></a>三 职业发展方向之谜</h1><p>也许这篇文章又一次输出了“焦虑”，但并非笔者本意。”焦虑”大概是开发者们最普遍的情绪，尤其是最近疫情的影响，不少公司开始裁员，更是给开发者群体造成了不小的影响，职业发展再度成为大家普遍困扰的话题。</p>
<p>在互联网上流传了三种不同的程序员发展路线图，一种是从程序员出发，然后干到专业工程师，高级工程师，架构师，技术负责人，技术总监，CTO；</p>
<p>还有一种是从程序员出发，干到技术总监，然后开始送外卖或者送快递，或者自己开个彩票店，或者便利店，然后闲庭细步，泡上一杯茶、去钓钓鱼，细细品味这人生的慢慢悠长。</p>
<p>当然，还有一种主流的发展路线，大概是最终走向创业，成为“万众创业”国家大计政策下的一颗螺丝钉。</p>
<p>我们该如何选择适合自己的职场方向呢？</p>
<p>在这篇文章中介绍了两个优秀的技术管理者，他们在自己的职场赛道上都遇到了一些困难，但也都一如既往的努力，那我们呢？</p>
<p>其实，无论你做什么，其实都难以一帆风顺，但只要踏实坚持，总能看到希望。焦虑无助于改变现状，倒不如沉下心来，干好当下。</p>
<p>​    </p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://techq.xyz/2020/05/17/随笔/是小厂全栈好，还是大厂专业工程师好？/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="溪源">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者技术圈圈圈">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/05/17/随笔/是小厂全栈好，还是大厂专业工程师好？/" class="post-title-link" itemprop="url">是小厂全栈好，还是大厂专业工程师好？</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-05-17 16:28:00" itemprop="dateCreated datePublished" datetime="2020-05-17T16:28:00+08:00">2020-05-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-05-26 19:11:24" itemprop="dateModified" datetime="2020-05-26T19:11:24+08:00">2020-05-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/随笔/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一"><a href="#一" class="headerlink" title="一"></a>一</h1><p>在博客园中使用小公司大公司进行搜索，列入的搜索记录长达50页。虽然完全命中关键词的文章也许并不多，但这或许也能体现出这个话题的热门程度。</p>
<p>今天我的公众号好友中也有人问了我这个问题：</p>
<blockquote>
<p>在小公司里面做全栈好，还是大公司里面做专业的前端或者后台好？</p>
</blockquote>
<p>对于这个问题，我大概有一点点发言权。在我过去若干年的职业生涯中，各种类型的公司也算都经历过，小一点的公司，大概有四五十人，大一点的公司有大几百人。</p>
<p>当然，与读者们的大厂比起来，都是小公司，着实不算大公司。但总体来说，也算是了解“专业工程师”和“全栈工程师”这两个名词背后的水深水浅。</p>
<h1 id="二"><a href="#二" class="headerlink" title="二"></a>二</h1><p>有时，当我们去跟一些人交流，会发现一个奇怪的现象，往往小公司的更喜欢称自己为“全栈工程师”，而大厂出来的，则反而不敢自称自己为“全栈工程师”。这究竟是为何呢？</p>
<p>我们可以继续引述经典理论“达克效应”。</p>
<p>1、不知道自己不知道。</p>
<p>2、知道自己不知道。</p>
<p>3、知道自己知道。</p>
<p>4、不知道自己知道。</p>
<p>这四个阶段其实无论在技术层面，还是职场发展过程中，都无处不在。</p>
<p><img src="https://uploader.shimo.im/f/mPlz1AqvNxxvh5Pf.png!thumbnail" alt="图片"></p>
<p>在我们每个人说起漫长，说起短暂的职业生涯中，总是会历经无穷次技术的发展，甚至变革，这些技术其实在给我们创造价值的同时，也一点点在我们的灵魂深处留下投影。</p>
<p>有的技术或理论，会对我们的职业发展产生非常深刻的影响；有的则如雨后彩虹一般，突然出现，却有遽然消失。</p>
<p>每一种技术或理论的产生总会有一套成体系的脉络，也许入门很容易，但要成为专家其实非常困难。达克效应表现的也是这样一种效应。</p>
<p>那些看起来很容易就学会的东西，往往要深入或许更加困难。而许多大厂开发者深刻体会其中的不容易，所以若非经过最少几百小时的学习，其实不敢自称为专家，更遑论自称“全栈工程师”了。</p>
<p>其实，有的人自称为“全栈工程师”，倒不如说是“全能工程师”—每种技术都或多或少懂一点，能够在很短的时间内完成任务，但一旦要有所深入，就略显不足，无法再进一步了。</p>
<h1 id="三"><a href="#三" class="headerlink" title="三"></a>三</h1><p>但，无法在技术层面有所深入，是一件难以启齿的事情么？</p>
<p>也许并非如此。我深深的感觉，在IT行业，看起来风起云涌，浪潮迭起，但依然充满前途和光明，其主要原因在于：人们对基于互联网场景下的应用，需求从来就没有因为互联网技术的发展而有所降低，反而越来越细致，越来越具体，产生着越来越深远的影响。</p>
<p>例如，很多年前就说美国互联网泡沫破灭，但今天互联网经济反而越来越重要了；移动互联网也有人唱衰，“说BAT才掌握船票，已经垄断中国经济，其他公司几乎毫无机会”。却莫名其妙间，又多出了头条、美团、小米、滴滴、京东、拼多多等数不尽的优秀互联网公司。</p>
<p>再过十年IT产业会逐渐退潮么，IT人才将会毫无施展才华的土壤么。不得而知，而且也不重要。重要的是，即便在互联网技术飞速发展的今天，中国依然对优秀的IT工程师非常稀缺。</p>
<h1 id="四"><a href="#四" class="headerlink" title="四"></a>四</h1><p><img src="https://uploader.shimo.im/f/PTI6SkTmd0rOlYEC.png!thumbnail" alt="图片"></p>
<p>时至今日，软件实现过程并没有因为软件技术人才的增加而逐渐简化，反而依然非常复杂。我们其实都能看到，在IT行业，五年经验以下的开发者始终居于大多数，不管是十年前，还是今天，行业都几乎没有太大的变化。我们能指望现在的年轻开发者能够提前规避我们之前遇到过的那些问题么？</p>
<p>历史告诉我们：人们走过的弯路，后人其实还是会再走一遍。看似大爆炸的互联网，知识满地都是。其实，知识过载和知识过乏没有任何区别。所以，我们写过的那些垃圾代码，我们以前遇到过的那些bug，依然有许多年轻人在沿着我们的步伐再走一遍。</p>
<p>那些隐藏在软件界面的冰山之下，难道bug突然减少了？究竟会不会在哪天突然爆发？客户提出的需求，程序员们究竟是如何实现的？</p>
<h1 id="五"><a href="#五" class="headerlink" title="五"></a>五</h1><p>我始终认为，专业工程师依然非常匮乏，无论过去、今天，或未来。</p>
<p>专业工程师或许不一定是某个领域的专家，也许是某些具备优秀跨职能能力的开发者。</p>
<p>他们首先能够基于某些行业场景出发，以独特的视角发掘问题的本质，并快速的将业务问题转换为技术实现，还能抽丝剥茧，发现不同事物之间的关联关系，从而更好的将业务问题以软件的形式进行呈现，</p>
<p>他们也能灵活的发现不同技术之间的优缺点，并使用合适的技术问题来进行适配，使得问题能够以最快的速度进行解决。</p>
<p>他们还能从多个角度出发，而不仅仅是从【软件代码实现】这个维度出发来解决问题，他们所具备的良好的沟通能力和专业素养，使得客户/用户能够愿意倾听提出的建议，从而以最少的代价来解决问题。</p>
<h1 id="六"><a href="#六" class="headerlink" title="六"></a>六</h1><p>成为专业工程师，与选择“大厂”或选择“小厂”有非常明显的区别么？</p>
<p>大公司和小公司都有不同的发展轨迹，不同的人适合不同的发展方向。无论怎么选，其实都是“小样本”。</p>
<p>个体选择走【跨职能型人才路线】或走【专业人才】路线，对于偌大的中国来说，都其实不会对历史的车轮产生多大的影响，但我们的选择其实是在慢慢的改变我们的生活。</p>
<p>有时，小厂在能够填补我们对于经济上的匮乏，又有时，选择了大厂会让我们以为未来的发展无忧。</p>
<p>确实如此，有时一些小厂反而能够比大厂提供短期内更加诱人的薪资，这对一些经济条件不太好的人来说，犹如“久旱甘霖”；而大厂看似平滑的发展曲线，能够让我们只要沿着设定的方向走下去，肯定不会走错。</p>
<p>但真的小厂就意味着“朝不保夕”，大厂就一定是“高枕无忧”么？谁也说不准。</p>
<p>最重要的，也许依然是认清自己的定位，无论在大厂，还是小厂，使自己成为出色的“专业工程师”，更加全面的成长，或许更能让我们的职场利于不败之地。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://techq.xyz/2020/05/15/技术/那些与EF有关的错误认知/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="溪源">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者技术圈圈圈">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/05/15/技术/那些与EF有关的错误认知/" class="post-title-link" itemprop="url">那些与EF有关的错误认知</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-05-15 19:07:00" itemprop="dateCreated datePublished" datetime="2020-05-15T19:07:00+08:00">2020-05-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-05-26 19:09:15" itemprop="dateModified" datetime="2020-05-26T19:09:15+08:00">2020-05-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这是一个对话性的讨论，它讨论了一个严重的问题趋势，我发现在由初级团队到架构师团队的各种规模的组织中，EntityFramework的利用率都很高。这不是一个如何做的问题,这也不适合新手。如果有什么能激发您的想法，或者您对我提到的事情感到好奇，那么Google是您的朋友。这也是我的第一篇博客文章。欢迎批评。</p>
<h1 id="历史和功能介绍（按版本）"><a href="#历史和功能介绍（按版本）" class="headerlink" title="历史和功能介绍（按版本）"></a>历史和功能介绍（按版本）</h1><p>首先，让我们简单回顾一下EF随时间推移推出的功能。这绝不是详尽无遗的，当然也不会通过对主要版本的更新列出所有内容。它只是提醒了迄今为止EF的故事。</p>
<h5 id="EF-EF-3-5"><a href="#EF-EF-3-5" class="headerlink" title="EF / EF 3.5"></a>EF / EF 3.5</h5><p>· DB First</p>
<h5 id="EF-4-0"><a href="#EF-4-0" class="headerlink" title="EF 4.0"></a>EF 4.0</h5><p>· Lazy Loading</p>
<p>· Migrations</p>
<p>· POCOs</p>
<h5 id="EF-5"><a href="#EF-5" class="headerlink" title="EF 5"></a>EF 5</h5><p>· Enums</p>
<p>· Spatial</p>
<h5 id="EF-6"><a href="#EF-6" class="headerlink" title="EF 6"></a>EF 6</h5><p>· Async</p>
<p>· Interception</p>
<p>· Logging</p>
<p>· NuGet Installation</p>
<p>· Recovery</p>
<h5 id="EF-7-Core"><a href="#EF-7-Core" class="headerlink" title="EF 7 / Core"></a>EF 7 / Core</h5><p>· Code First Only</p>
<p>· In-Memory Support</p>
<p>· Limited Batching</p>
<p>· Nonrelational Support</p>
<p>看到这种零散的发布以及Microsoft在开发领域的普遍声誉，Entity Framework有了一个不好的惊喜，并不是因为它为我将要解决的问题找借口而已。根据您正在使用的次要版本，功能似乎随机出现。因此，即使安装了相同的主要版本，您仍会习惯某些东西，转到另一个环境，提出声明并在其现有框架上进行尝试，即使它没有安装，您也仍然会“告诉您”的样子有助于进一步加深已经确立的地位。</p>
<p>基本上，EF的典型故事如下：</p>
<p>高级人士：“让我们使用EF和仓储模式！”</p>
<p>其他开发人员：“ Idk，还没听说过好消息。”</p>
<p>高级：“不，太好了！看到这个例子吗？”</p>
<p>开发人员：“嗯，好的。”</p>
<p>起初，它的工作原理在可接受的范围内。然而，随着它的增长，迟缓开始出现，人们开始抱怨。由于我们行业中偿还技术债务的状况非常糟糕，或者由于完全拒绝首先查看仓储模式中的技术债务，因此，据称聪明的人的整个部门都袖手旁观，只是得出结论，<code>”EF是垃圾&quot;</code>，并不是说他们的使用是垃圾。</p>
<p>我在这里要说明的是后者，并向您展示如何避免该陷阱。</p>
<h1 id="EF使Sql查询过程得以抽象"><a href="#EF使Sql查询过程得以抽象" class="headerlink" title="EF使Sql查询过程得以抽象"></a>EF使Sql查询过程得以抽象</h1><p>在我职业生涯的早期，我开始直接通过ADO使用经典的ASP和SQL Server。我在一个非常小的网络部门工作，因此我经常不得不亲自进入数据库来创建表和执行任务。在一系列复制/粘贴部署，生产测试等过程中，我很快熟悉了SQL Server的所有技巧。“那这个呢？<em>不会，该产品页面仍然无法加载。</em>那个怎么样？！<em>不，仍然无法加载。</em>来吧…这个？<em>成功！</em>通过几乎在黑暗中绊倒，我对索引，视图，复制，安全权限等等非常了解，当时甚至还没读完高中。</p>
<p>使用结构化的环境输入我的前几个地方，然后使用Entity Framework时让我非常脸红。它完全没有我习惯的任何选择。因此，我跳上船，但是没多久就开始抱怨。如果您有金鱼的记忆，让我重申我习惯于随意调整所有杠杆。遇到问题时，我会进行调查。通常，我发现诸如索引利用率之类的关键组件被完全忽略了。当我提出这些问题时，我被告知EF因不知道如何利用它们而感到过失，而我们是在这里处理业务问题，而不是由Microsoft来为他们做。老实说，我基本上还是一个初级开发人员。我有什么理由不同意呢?</p>
<h2 id="仓储模式存在的问题"><a href="#仓储模式存在的问题" class="headerlink" title="仓储模式存在的问题"></a>仓储模式存在的问题</h2><p>点击访问<a href="http://bfy.tw/3pSK" target="_blank" rel="noopener">仓储模式</a>。仓储模式的问题有两个方面。存储库模式的问题有两个方面。首先，它要求您预先声明如何绑定应用程序与数据库进行交互。即使您构建了这些超级复杂的方法，这些方法允许您传入表达式、字典或异常动态，并且您很有创造力，但是您所做的只是制造了一个维护噩梦。</p>
<p>“但是调用者可以定义他们所需要的！” 不，他们不能。当然，他们可以指向实体并通常定义要选择的数据的形状，但是他们无法确定字段选择之类的内容。他们没有办法说他们需要以一种友好的方式预先加载数据或延迟数据。他们不能在一次实例化中说他们也需要来自这里或那里的数据，但在下一次实例化中，他们只需要找到目标实体，除非神圣的存储库允许他们这样做。相反，您会得到这些全有或全无的决策，这些决策将您的应用程序链接在一起，我们想知道为什么它会很快降级。我真的希望你的水晶球比我的好。</p>
<p>其次，即使是微软自己的例子也没有使用某些实习生可能编写的适当接口。因此，我说，每个人都做错了。关于EF的常识是使用存储库模式，由于存储库模式本身的文档和示例不正确，所以没有人会让EF做它被设计用来做的事情，因为知识的来源受到了毒害。面对这种情况，我听到很多人抱怨说MVC教程的例子直接使用了DbContext，抱怨说它不够稳定，也不是说几乎没有人做得很稳定，但这是另一篇博客文章。(大多数软件直接跳转到ID，忽略了其他的。)</p>
<h2 id="让数据库成为数据库"><a href="#让数据库成为数据库" class="headerlink" title="让数据库成为数据库"></a>让数据库成为数据库</h2><p>由于SQL Server是EF中最常用的支持数据存储，因此它不是一个干净的软件。太乱了 ，它具有大量场景的功能。如果您想让您的应用程序实际使用您所支付的巨额许可费用的一小部分，请停止将SQL约束到EF驱动的地狱荒原，而这些荒地比SELECT *还要好。然后，我们喜欢抱怨事情进展缓慢。</p>
<p>如果您不让EF在正确的情况下利用功能，则可能无法意识到平台的潜力。必须浪费数十亿美元的许可和开发成本，即使在应用程序以截然不同的方式增长时，使用的独特功能也只会使SQL Server的单位利用率下降。这是一种直觉，但是看到我在大型和小型公司中看到的愚蠢的朴素仓储实现，很难在这里看到我是完全错误的。这对我们自己，我们的雇主和彼此都是有害的。</p>
<p>实体框架仍然逐步锁定在基础数据存储的工作方式上。在SQL Server中，这意味着联接性能，视图和索引利用率，存储过程调用等。这就像将乳胶手套称为手的抽象。它不是，EF也不是它所依赖的存储机制的抽象。相反，它是一组通用的API，它们使我们能够以统一的方式访问数据。由于我刚才所说的原因（我们不能以任何方式否认或减轻基础实现的行为），这不是一个抽象。因此，我们必须在代码中考虑显式或隐式破坏抽象的那些行为。如果要假装它是抽象，我们唯一能做的就是把头埋在沙子里，然后在事情变得笨拙时继续continue吟。</p>
<p>最近，我遇到了—架构师—几乎对让数据库定义视图和将EF指向视图而不是表的建议感到敬畏，您知道，这让dba能够真正完成他们的工作，并使数据库能够在不破坏应用程序代码的情况下进行更改。这并不是什么难事，但问题是普遍存在的，所以大多数人在他们太熟悉的环境中都看不到过去。那么，我们该怎么做呢?</p>
<h1 id="使用IQueryable而不是IEnumerable"><a href="#使用IQueryable而不是IEnumerable" class="headerlink" title="使用IQueryable而不是IEnumerable"></a>使用IQueryable而不是IEnumerable</h1><p>正确使用Entity Framework的第一步是打破与IEnumerable的依赖关系。当谈论断开连接的商店时，这是很糟糕的。IEnumerable唯一给出的就是延迟执行。如果这是您想要脱离ORM的唯一功能，那么您就不需要ORM。IEnumerable隐瞒使用数据存储的原因在于，它们一劳永逸地固定在它们的表示中。即使应用程序增长，即使仓储中添加了新方法，返回IEnumerable的旧实现也对它们所处的新世界都是盲目，聋哑和愚蠢的。您实际上是在强迫代码与数据布局和期望一起使用。就像几年前首次实施时一样。这是开发人员的错，但应归咎于EF。</p>
<p>但是，IQueryable可以变形并更改为其给定的上下文。即使传递和添加了子句，它也可以评估实例，例如各个调用的需求。如果DbContext已经获取了数据，但它仍可以从高速缓存中检索实体，然后才能以非常快的速度进行重复调用，从而使热路径更加凉爽。更重要的是，它还提供了一些功能，例如，如果基础提供程序支持的话，让我们流数据；无需实例化List对象以使其对堆更友好地加载数据；检查基础类型，以便我们可以在复杂的工作流程中做出明智的决定；访问基础上下文, 等等。</p>
<p>这些都是使您的代码真正了解正在发生的事情而不会破坏抽象障碍的所有功能，因为EF不是抽象。顺便说一句，抽象应该是使用EF的组件，而不是EF本身。我在程序员进行的许多讨论中表达了自己的见解，这些讨论表达了一些需求，但是我们以“抽象”的名义对许多解决方案solutions之以鼻，随之而来的是我们高兴地扭曲自己的箍，这样我们就可以继续存在固体。</p>
<h1 id="习惯匿名类型"><a href="#习惯匿名类型" class="headerlink" title="习惯匿名类型"></a>习惯匿名类型</h1><p>我听说过的关于EF的最大的抱怨也许就是它检索了多少该死的数据。谁定义实体？EF？没有！你做到了 从本质上讲，您不必多怪，因为每个表的实体似乎是所有人都可以看到的。尽管如此，无论实体有多大，我们都无需受到阻碍。将匿名类型传递给EF查询将导致EF仅选择您定义的字段。可以将数十列的“无法重构”的怪物表分解为实际需要的3或4个字段。一次选择整个实体并假装无能为力的迷恋只能描述为一种大众歇斯底里的形式，我们大声疾呼，“我看不到你！”</p>
<h1 id="使用正确的工具完成工作"><a href="#使用正确的工具完成工作" class="headerlink" title="使用正确的工具完成工作"></a>使用正确的工具完成工作</h1><p>您知道所有带有封面上各种工具的Microsoft Press书籍吗？您知道，除了某些人只是选择随机图像之外，还有一个原因。大多数工具不仅是螺丝起子或刨刀。有一些真正的奇怪应用没有明显的应用，但是可以肯定的是，它们有自己的目标，并且擅长于此。“正确的工具”的口号经常重复出现，但是我们并没有真正停下来思考工作，更不用说工具了。以下是EF的一些功能。</p>
<h3 id="自-Net-2-0以来出现的SqlBulkCopy"><a href="#自-Net-2-0以来出现的SqlBulkCopy" class="headerlink" title="自.Net 2.0以来出现的SqlBulkCopy"></a>自.Net 2.0以来出现的SqlBulkCopy</h3><p>另一个与EF数据量密切相关的大型抱怨是，EF检索到它据称无法处理大量数据的方式。我喜欢开发人员的双重性。我想让您知道，结合下面讨论的AsStreaming，反应性扩展和SqlBulkCopy，我可以在一分钟内检索，转换和推送数百万条记录，而不会费力地创建一个完全基于任何工作负载的完全基于代码的ETL解决方案从较小的记录到中等大小的记录（例如5–100亿条记录），并且仍然具有良好的性能。如果您需要更多，则有更多专用工具。但是，不要说Entity Framework无法处理大量数据。 <em>您的代码无法处理大量数据。</em>EF很好。</p>
<p>可悲的是，自2005年以来我们就拥有SqlBulkCopy，但我们却假装工具箱中有这个大漏洞。问题已经解决。重新发明轮子的理由为零。你猜怎么了？它也支持流！</p>
<h3 id="AsTracking与AsNoTracking"><a href="#AsTracking与AsNoTracking" class="headerlink" title="AsTracking与AsNoTracking"></a>AsTracking与AsNoTracking</h3><p>我觉得自己的成绩很差。关于EF的另一个大抱怨是它的数据缓存。您几乎总是可以告诉DbContext摆脱缓存的实体。不过，最近，我们获得了将其设置为Entity Framework Core中默认策略的能力。相反，我们可以选择要跟踪的内容，而不是不需要的内容。我很高兴地承认一个烦恼，即您仍然需要分离实体。</p>
<h3 id="流式传输"><a href="#流式传输" class="headerlink" title="流式传输"></a>流式传输</h3><p>实体框架中的查询通常在返回之前缓冲所有结果。流技术解决了这一问题，并立即让您开始处理数据进入应用程序的过程。您既可以更快地开始工作，又可以使服务器对内存更友好。</p>
<h3 id="特殊雪花"><a href="#特殊雪花" class="headerlink" title="特殊雪花"></a>特殊雪花</h3><p>在开发人员中，我看到了一个令人不安的趋势。缺乏探索和发明的欲望。我们想要开箱即用的解决方案，在不了解细节的情况下“可行”。即使代码不是魔术，我们仍然相信看不见的魔术。</p>
<p>我采用的一般方法不是构建这些固定的仓储，而是构建扩展，使我们的应用程序以我们需要它们的独特方式运行。是否希望在运行时间较长的过程中缓存数据的好处，但又不能在给定操作之外继续存在呢？对于我来说，这听起来像是DbContext的完美扩展方法，该方法可以获取一些实体，对其进行处理以获得缓存的好处，然后在返回之前清除缓存。另一种扩展方法是在操作完成后分离所有那些实体的方法。</p>
<h1 id="不要害怕"><a href="#不要害怕" class="headerlink" title="不要害怕"></a>不要害怕</h1><p>我在这里谈论DbContext是因为有很多人对待它。它被视为一件大，笨重，笨拙的事情，如果您不小心的话，它们会偷走您的孩子。我们花了很长的时间才能使DbContext的存在只为少数几个组件所知。这将我们的实现进一步扼杀到仓储中。由于我们<em>必须</em>遍历仓储以获取任何类型的数据，因此我们需要在发生更改时定期违反“开放/关闭”原则，或者被迫接受仓储指示的决策膨胀的折衷，并且在使用时要格外小心我们打电话给它。</p>
<p>释放DbContext。如果模块需要数据，请不要自欺欺人，说DbContext还不是依赖项。我可以向您保证，如果您对它的可访问性感到满意，并消除“人们犯错了怎么办？！”的神秘主义。它实际上将使我们整体上变得更好。如果某人可以提交顽皮的代码，并且至少使它经过一次未经测试的生产，则您实际上就没有发布控制或质量检查。诸如隐藏DbContext之类的策略是您组织中已经流血的伤口上的权宜之计，无助于真正缓解实际问题。</p>
<h1 id="别再找借口"><a href="#别再找借口" class="headerlink" title="别再找借口"></a>别再找借口</h1><p>我们程序员必须停止像解决我们所遇到的问题的解决方案那样行动，或者必须使用node.js和dapper的正确组合来区分它们，这并不是说它们没有合法用途，而是经常被他们当作替罪羊实体框架是一种很好的工具，可以用来做某事。我们十年来拥有的工具已经足以满足我们的大多数需求。一次又一次的错误决定最终导致错误的决定，使我们陷入困境。使您的工具适应自如。尝试新事物。可以肯定的是，我们只能怪自己。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://techq.xyz/2020/05/12/技术/最佳REST API最佳做法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="溪源">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者技术圈圈圈">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/05/12/技术/最佳REST API最佳做法/" class="post-title-link" itemprop="url">使用REST API 最佳实践简述</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-05-12 19:07:00" itemprop="dateCreated datePublished" datetime="2020-05-12T19:07:00+08:00">2020-05-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-05-26 19:09:57" itemprop="dateModified" datetime="2020-05-26T19:09:57+08:00">2020-05-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="使用REST-API-最佳实践简述"><a href="#使用REST-API-最佳实践简述" class="headerlink" title="使用REST API 最佳实践简述"></a>使用REST API 最佳实践简述</h1><p>Facebook，Google，Github，Netflix，Amazon和Twitter等许多巨头都拥有自己的REST（ful）API，您可以访问它们来获取甚至写入数据。</p>
<p>但是，为什么所有都需要REST？</p>
<p>那样好吗，为什么如此盛行？</p>
<p>当然，这不是传达消息的唯一方法吗？</p>
<p>REST和HTTP有什么区别？</p>
<p>好吧，事实证明<strong>REST非常灵活，并且与</strong> Internet所基于的主要协议<strong>HTTP兼容</strong>。由于它是一种架构风格而不是标准，因此它<strong>提供了实现各种设计最佳实践的大量自由</strong>。以及听说它与语言无关？你一定觉得它很棒吧。</p>
<p>在此博客文章中，我们的目标是尽可能清楚地解释REST，以便您可以清楚地了解何时以及如何使用REST，以及它的本质。</p>
<p>我们将介绍一些基础知识和定义，并展示一些<strong>REST API最佳实践</strong>。这应该为您提供了以您喜欢的任何编码语言实现REST API所需的全部知识。</p>
<p>如果您对HTTP不太熟悉，建议您阅读我们的<a href="https://code-maze.com/http-series/" target="_blank" rel="noopener">HTTP系列文章</a>，或者至少阅读其中的<a href="https://code-maze.com/http-series-part-1/" target="_blank" rel="noopener">第1部分</a>，这样您可以更轻松地理解这些资料。</p>
<p>因此，在这篇文章中，我们将讨论：</p>
<p><strong>关于REST：</strong></p>
<ul>
<li><a href="https://code-maze.com/top-rest-api-best-practices/#whatisrest" target="_blank" rel="noopener">什么是REST？</a></li>
<li><a href="https://code-maze.com/top-rest-api-best-practices/#restbound" target="_blank" rel="noopener">REST是否绑定到HTTP？</a></li>
<li><a href="https://code-maze.com/top-rest-api-best-practices/#hateoas" target="_blank" rel="noopener">REST和HATEOAS支持</a></li>
<li><a href="https://code-maze.com/top-rest-api-best-practices/#whatdoesitmean" target="_blank" rel="noopener">RESTful API是什么意思？</a></li>
<li><a href="https://code-maze.com/top-rest-api-best-practices/#restafarian" target="_blank" rel="noopener">REST过多又称为RESTafarian综合征</a></li>
</ul>
<p><strong>REST API最佳做法：</strong></p>
<ul>
<li><a href="https://code-maze.com/top-rest-api-best-practices/#abstractvsconcrete" target="_blank" rel="noopener">抽象与具体API</a></li>
<li><a href="https://code-maze.com/top-rest-api-best-practices/#urlformat" target="_blank" rel="noopener">URI格式（名词，不是动词）。正确网址与错误网址示例</a></li>
<li><a href="https://code-maze.com/top-rest-api-best-practices/#errorhandling" target="_blank" rel="noopener">错误处理</a></li>
<li><a href="https://code-maze.com/top-rest-api-best-practices/#statuscodes" target="_blank" rel="noopener">状态码</a></li>
<li><a href="https://code-maze.com/top-rest-api-best-practices/#security" target="_blank" rel="noopener">安全</a></li>
<li><a href="https://code-maze.com/top-rest-api-best-practices/#versioning" target="_blank" rel="noopener">REST API版本控制</a></li>
<li><a href="https://code-maze.com/top-rest-api-best-practices/#documentation" target="_blank" rel="noopener">文件的重要性</a></li>
</ul>
<h2 id="那么REST本质上是什么？"><a href="#那么REST本质上是什么？" class="headerlink" title="那么REST本质上是什么？"></a>那么REST本质上是什么？</h2><p>REST（代表性状态转移）是<a href="https://en.wikipedia.org/wiki/Roy_Fielding" target="_blank" rel="noopener">Roy Fielding</a>在其博士学位中创立的一种建筑风格。UC Irvine的论文“ <a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm" target="_blank" rel="noopener">体系结构样式和基于网络的软件体系结构设计</a> ”。 他与HTTP 1.1同步提出了这种观点。</p>
<p>我们主要将REST用作<strong>在万维网上的计算机系统之间进行通信的</strong>一种方式。</p>
<h2 id="REST是否绑定到HTTP？"><a href="#REST是否绑定到HTTP？" class="headerlink" title="REST是否绑定到HTTP？"></a>REST是否绑定到HTTP？</h2><p>根据定义，似乎与Http强制绑定？其实并非如此。尽管您可以将其他一些应用程序协议与REST一起使用，但是在实现REST时，<a href="https://code-maze.com/http-series/" target="_blank" rel="noopener">HTTP</a>仍然是应用程序协议中无可争议的冠军。</p>
<h2 id="REST和HATEOAS支持"><a href="#REST和HATEOAS支持" class="headerlink" title="REST和HATEOAS支持"></a>REST和HATEOAS支持</h2><p><strong>作为应用程序状态引擎的</strong> HATEOAS或<strong>超媒体</strong> 是每个可扩展且灵活的REST API的重要功能。</p>
<p>该<a href="https://en.wikipedia.org/wiki/HATEOAS" target="_blank" rel="noopener">HATEOAS</a>约束建议，客户端和服务器通信完全采用了<a href="https://en.wikipedia.org/wiki/Hypermedia" target="_blank" rel="noopener">超媒体</a>。</p>
<p>使用超媒体有几个优点：</p>
<ul>
<li>使API设计人员能够在每个响应中包括他们所能提供的一切，以正确地提供一件事以及与相关端点的超媒体链接，从而使设计脱钩</li>
<li>帮助API更优雅地发展和成熟</li>
<li>为用户提供更深入地探索API的方法</li>
</ul>
<p>因此很明显，HATEOAS在<strong>设计时考虑了耐用性</strong>。</p>
<p>GitHub的工作方式如下： </p>
<p><code>GET https://api.github.com/users/codemazeblog</code></p>
<p>响应：  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"login"</span>: <span class="string">"CodeMazeBlog"</span>,</span><br><span class="line">  <span class="string">"id"</span>: <span class="number">29179238</span>,</span><br><span class="line">  <span class="string">"avatar_url"</span>: <span class="string">"https://avatars0.githubusercontent.com/u/29179238?v=4"</span>,</span><br><span class="line">  <span class="string">"gravatar_id"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"https://api.github.com/users/CodeMazeBlog"</span>,</span><br><span class="line">  <span class="string">"html_url"</span>: <span class="string">"https://github.com/CodeMazeBlog"</span>,</span><br><span class="line">  <span class="string">"followers_url"</span>: <span class="string">"https://api.github.com/users/CodeMazeBlog/followers"</span>,</span><br><span class="line">  <span class="string">"following_url"</span>: <span class="string">"https://api.github.com/users/CodeMazeBlog/following&#123;/other_user&#125;"</span>,</span><br><span class="line">  <span class="string">"gists_url"</span>: <span class="string">"https://api.github.com/users/CodeMazeBlog/gists&#123;/gist_id&#125;"</span>,</span><br><span class="line">  <span class="string">"starred_url"</span>: <span class="string">"https://api.github.com/users/CodeMazeBlog/starred&#123;/owner&#125;&#123;/repo&#125;"</span>,</span><br><span class="line">  <span class="string">"subscriptions_url"</span>: <span class="string">"https://api.github.com/users/CodeMazeBlog/subscriptions"</span>,</span><br><span class="line">  <span class="string">"organizations_url"</span>: <span class="string">"https://api.github.com/users/CodeMazeBlog/orgs"</span>,</span><br><span class="line">  <span class="string">"repos_url"</span>: <span class="string">"https://api.github.com/users/CodeMazeBlog/repos"</span>,</span><br><span class="line">  <span class="string">"events_url"</span>: <span class="string">"https://api.github.com/users/CodeMazeBlog/events&#123;/privacy&#125;"</span>,</span><br><span class="line">  <span class="string">"received_events_url"</span>: <span class="string">"https://api.github.com/users/CodeMazeBlog/received_events"</span>,</span><br><span class="line">  <span class="string">"type"</span>: <span class="string">"User"</span>,</span><br><span class="line">  <span class="string">"site_admin"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"Code Maze"</span>,</span><br><span class="line">  <span class="string">"company"</span>: <span class="string">"Code Maze"</span>,</span><br><span class="line">  <span class="string">"blog"</span>: <span class="string">"https://code-maze.com"</span>,</span><br><span class="line">  <span class="string">"bio"</span>: <span class="string">"A practical programmers' resource."</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如您所见，除了客户端请求的关键信息之外，您还可以在响应中找到一堆相关的超媒体链接，这些链接将您带到您可以自由浏览的API的其他部分。</p>
<h2 id="RESTful-API是什么意思？"><a href="#RESTful-API是什么意思？" class="headerlink" title="RESTful API是什么意思？"></a>RESTful API是什么意思？</h2><p>“ RESTful”意味着一些功能：</p>
<ul>
<li><strong><a href="https://code-maze.com/http-series-part-2" target="_blank" rel="noopener">客户端-服务器体系结构</a>：</strong>完整的服务由作为整个系统前端的“客户端”和作为后端的“服务器”组成</li>
<li><strong>无状态：</strong>服务器不应在不同请求之间保存任何状态。会话状态完全由客户负责。按照REST定义： <strong><em>所有REST交互都是无状态的。也就是说，每个请求都包含连接器理解该请求所需的所有信息，而与之前的任何请求无关。（<a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm" target="_blank" rel="noopener">Roy的论文ch.5.2.2</a>）\</em></strong></li>
<li><strong><a href="https://code-maze.com/http-series-part-2/#caching" target="_blank" rel="noopener">可缓存的</a>：</strong>客户端应该能够将响应存储在缓存中以提高性能</li>
</ul>
<p>因此，RESTful API是一项遵循这些规则的服务（希望如此），并使用<a href="https://code-maze.com/the-http-reference/#requestmethods" target="_blank" rel="noopener">HTTP方法</a>来操纵资源集。</p>
<p>但是为什么我们需要或使用RESTful API？</p>
<p>因为它们为我们提供了一种简单，灵活和可扩展的方式来制作可通过Internet进行通信的分布式应用程序。</p>
<h2 id="我们可以拥有更多的REST方法吗？"><a href="#我们可以拥有更多的REST方法吗？" class="headerlink" title="我们可以拥有更多的REST方法吗？"></a>我们可以拥有更多的REST方法吗？</h2><p>是的，你猜对了。是的，我们可以🙂</p>
<p>正如<a href="http://mikeschinkel.com/about/" target="_blank" rel="noopener">Mike Schinkel</a>定义的那样，对于狂热地遵循REST的人们来说甚至还有一个短语 <a href="http://mikeschinkel.com/about/" target="_blank" rel="noopener">。</a></p>
<blockquote>
<p>RESTifarian是Roy T. Fielding在他的博士论文第五章中定义的REST软件架构风格的狂热支持者。论文在UCIrvine。你可以在rest - discussion邮件列表中找到野外的RESTifarians。但是要小心，RESTifarians在讨论休息的细节时可能是极其细致的，正如我最近在参与列表时所了解到的。🙂</p>
</blockquote>
<p>太多的事情都是不好的。</p>
<p>我们需要一点<strong>实用主义</strong>才能做出好的应用程序和服务。了解和理解一种理论很重要，但是该理论的实现是区分不良与良好与卓越应用的区别。所以要聪明，要牢记最终用户。</p>
<p>因此，让我们走一些使API变得“光彩”的重要点，使用户的生活变得更加轻松。</p>
<h2 id="抽象与具体API"><a href="#抽象与具体API" class="headerlink" title="抽象与具体API"></a>抽象与具体API</h2><p>在开发软件时，我们经常使用抽象和多态来获取大多数应用程序。我们想重用尽可能多的代码。</p>
<p>那么我们也应该这样写我们的API吗？</p>
<p>好吧，API并非完全如此。对于REST API，<strong>具体要比abstract好</strong>。你能猜出为什么吗？</p>
<p>让我向您展示一些示例：</p>
<p>让我们看两个API版本。它是最好有有一个的API <code>/entities</code>，或者有一个API <code>/owners</code>，<code>/blogs</code>并 <code>/blogposts</code> 分别？</p>
<p>作为开发人员，哪一个对您更具描述性？您想使用哪个API？</p>
<p>我总是会选择第二个。</p>
<h2 id="URI格式（名词，不是动词）。正确网址与错误网址示例"><a href="#URI格式（名词，不是动词）。正确网址与错误网址示例" class="headerlink" title="URI格式（名词，不是动词）。正确网址与错误网址示例"></a><strong>URI格式（名词，不是动词）。正确网址与错误网址示例</strong></h2><p>这是另一种REST API最佳实践。您应该如何格式化端点？</p>
<p>如果使用软件开发方法，您将得到如下所示的结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/getAllBlogPosts</span><br><span class="line">/updateBlogPost/12</span><br><span class="line">/deleteBlogPost/12</span><br><span class="line">/getAuthorById/3</span><br><span class="line">/deleteAuthor/3</span><br><span class="line">/updateAuthor/3</span><br></pre></td></tr></table></figure>

<p>您明白了……会有很多端点，每个端点都在做其他事情。有一个更好的系统可以解决这些问题。</p>
<p>将资源视为名词，将HTTP方法视为动词。如果这样做，最终将得到如下结果：</p>
<p><code>GET /blogposts</code> –获取所有博客文章</p>
<p><code>GET /blogposts/12</code> –获取ID为12的博客文章</p>
<p><code>POST /blogposts</code> –添加新的博客文章并返回详细信息</p>
<p><code>DELETE /blogposts/12</code> –删除ID为12的博客文章</p>
<p><code>GET /authors/3/blogposts</code> –获取ID为3的作者的所有博客文章</p>
<p>这是创建API的更简洁，更精确的方法。对于最终用户而言，这是显而易见的，并且有一种解决方法。</p>
<p>通过使用单数而不是复数来表示资源名称，可以使其更加简洁。那取决于你。</p>
<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a><strong>错误处理</strong></h2><p>API构建的另一个重要方面。有几种处理错误的好方法。</p>
<p>让我们看看顶级狗如何做到这一点：</p>
<p><strong>推特：</strong></p>
<ul>
<li><p>请求： <code>GET https://api.twitter.com/1.1/account/settings.json</code></p>
</li>
<li><p>响应：状态码400</p>
<p>Twitter response</p>
</li>
</ul>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;errors&quot;:[&#123;&quot;code&quot;:215,&quot;message&quot;:&quot;Bad Authentication data.&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>



<p>Twitter为您提供状态代码和错误代码，并简要描述了所发生错误的性质。他们让您在“ <a href="https://developer.twitter.com/en/docs/basics/response-codes" target="_blank" rel="noopener">响应代码”</a>页面上查找代码。</p>
<p><strong>脸书：</strong></p>
<ul>
<li><p>请求： <code>GET https://graph.facebook.com/me/photos</code></p>
</li>
<li><p>响应：状态码400</p>
<p>Facebook Response </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;  &quot;error&quot;: &#123;   &quot;message&quot;: &quot;An active access token must be used to query information about the current user.&quot;,   &quot;type&quot;: &quot;OAuthException&quot;,   &quot;code&quot;: 2500,   &quot;fbtrace_id&quot;: &quot;DzkTMkgIA7V&quot;  &#125;&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>Facebook为您提供了更具描述性的错误消息。</p>
<p><strong>特威里奥：</strong></p>
<ul>
<li><p>请求： <code>GET https://api.twilio.com/2010-04-01/Accounts/1234/IncomingPhoneNumbers/1234</code></p>
</li>
<li><p>响应：状态码404 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&apos;1.0&apos; encoding=&apos;UTF-8&apos;?&gt;&lt;TwilioResponse&gt;  &lt;RestException&gt;    &lt;Code&gt;20404&lt;/Code&gt;    &lt;Message&gt;The requested resource /2010-04-01/Accounts/1234/IncomingPhoneNumbers/1234 was not found&lt;/Message&gt;    &lt;MoreInfo&gt;https://www.twilio.com/docs/errors/20404&lt;/MoreInfo&gt;    &lt;Status&gt;404&lt;/Status&gt;  &lt;/RestException&gt;&lt;/TwilioResponse&gt;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>Twilio默认为您提供XML响应，并提供指向文档的链接，您可以在其中找到错误的详细信息。</p>
<p>如您所见，错误处理的方法因实现而异。</p>
<p>重要的是 <strong>不要让REST API的用户“挂断”</strong>，不知道发生了什么，或者漫无目的地在StackOverflow的浪费中徘徊，寻找解释。</p>
<h2 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a><strong>状态码</strong></h2><p>在设计REST API时，我们通过使用<a href="https://code-maze.com/the-http-reference/#statuscodes" target="_blank" rel="noopener">HTTP状态代码</a>与API用户进行通信 。状态代码很多，描述了多种可能的响应。</p>
<p>但是，我们应该使用多少？ <strong>我们在每种情况下都应该有严格的状态码吗？</strong></p>
<p>就像生活中的许多事情一样， <a href="https://en.wikipedia.org/wiki/KISS_principle" target="_blank" rel="noopener">KISS原则</a> 也适用于这里。那里有70多个状态代码。你内心了解他们吗？潜在的API用户会全部了解它们，还是会再次使用Google搜索？</p>
<p>大多数开发人员都熟悉最常见的状态代码：</p>
<ul>
<li><code>**200 OK**</code></li>
<li><code>**400 Bad Request**</code></li>
<li><code>**500 Internal Server Error**</code></li>
</ul>
<p>从这三个开始，您可以涵盖REST API的大多数功能。</p>
<p>其他常见的代码包括：</p>
<ul>
<li><code>**201 Created**</code></li>
<li><code>**204 No Content**</code></li>
<li><code>**401 Unauthorized**</code></li>
<li><code>**403 Forbidden**</code></li>
<li><code>**404 Not Found**</code></li>
</ul>
<p>我们可以使用它们来帮助用户快速找出结果。如果您感觉到状态代码的描述性不如我们在“错误处理”部分中讨论的那样，则可能应该包含某种消息。再一次，我们需要务实，通过使用 <strong>数量有限的代码</strong> 和描述性消息来帮助用户。</p>
<p>您可以在<a href="https://code-maze.com/the-http-reference" target="_blank" rel="noopener">此处</a>找到完整的HTTP状态代码列表，以及<a href="https://code-maze.com/the-http-reference" target="_blank" rel="noopener">在CodeMaze上总结的</a>其他有用的HTTP内容 。</p>
<h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a><strong>安全</strong></h2><p>关于<a href="https://blog.restcase.com/top-5-rest-api-security-guidelines/" target="_blank" rel="noopener">REST API安全的</a>说法不多，因为 <strong>REST不处理安全问题</strong>。它依赖于诸如<a href="https://code-maze.com/http-series-part-4/" target="_blank" rel="noopener">基本身份验证或摘要身份验证之</a>类的标准HTTP机制 。</p>
<p>每个请求都应 <strong>通过HTTPS进行</strong>。</p>
<p>有很多技巧可以提高REST API的安全性，但是由于REST的无状态性，因此在实施它们时必须谨慎。记住最后一个请求的状态超出了窗口，<strong>应该</strong>在 <strong>客户端存储和验证状态。</strong></p>
<p><strong>时间戳记和日志记录</strong> 请求也可以有所帮助。</p>
<p>关于这个话题还有很多要说的，但这超出了本文的范围。我们有一个不错的职位<strong><a href="https://code-maze.com/http-series-part-5/" target="_blank" rel="noopener">HTTP安全</a></strong> 在这里CodeMaze如果您想了解更多关于这一点。 </p>
<h2 id="REST-API版本控制"><a href="#REST-API版本控制" class="headerlink" title="REST API版本控制"></a><strong>REST API版本控制</strong></h2><p>您已经编写了REST API，它已经非常成功，许多人已经使用它并对此感到满意。但是，您拥有的多汁的新功能会破坏系统的其他部分。重大变化。</p>
<p>不用担心，有解决方案！</p>
<p>在开始制作您的API之前，我们可以通过在端点之前加上API版本来对其进行版本控制：<br><code>https://api.example.com/v1/authors/2/blogposts/13</code></p>
<p>这样，只要API发生重大更改，我们就可以始终增加API版本号（例如v2，v3…）。这也向用户发出信号，表明已发生了翻天覆地的变化，在使用新版本时，请务必小心。</p>
<h2 id="文件的重要性"><a href="#文件的重要性" class="headerlink" title="文件的重要性"></a><strong>文件的重要性</strong></h2><p>这是不言而喻的。您可能是世界上最好的API设计人员，但是 <strong>如果没有文档，您的API就像死了一样。</strong></p>
<p><strong>正确的文档</strong> 对于每个软件产品和Web服务都是<strong>必不可少</strong>的。</p>
<p>我们可以通过保持一致并使用清晰和描述性的语法来帮助用户。但是，好的文档页面并没有真正的替代品。</p>
<p>一些很好的例子：</p>
<p><a href="https://www.twilio.com/docs/api/rest/" target="_blank" rel="noopener">https://www.twilio.com/docs/api/rest/</a></p>
<p><a href="https://developers.facebook.com/docs/" target="_blank" rel="noopener">https://developers.facebook.com/docs/</a></p>
<p><a href="https://developers.google.com/maps/documentation/" target="_blank" rel="noopener">https://developers.google.com/maps/documentation/</a></p>
<p>还有很多其他…</p>
<p>有许多工具可以帮助您记录您的API，但是不要忘记让人参与其中，只有一个人可以正确地理解另一个人。至少现在是这样(看着你)。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>我们讨论了REST API构建的许多概念，并介绍了一些顶级REST API最佳实践。在一次提供这些API时，您可能会觉得有些奇怪或难以接受，但是请尝试自己创建REST API。并尝试实现一些您在这里学到的REST API最佳实践。 </p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">溪源</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">65</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.cnblogs.com/xiyuanmore" title="博客园 &rarr; https://www.cnblogs.com/xiyuanmore" rel="noopener" target="_blank"><i class="fa fa-fw fa-博客园"></i>博客园</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://blog.csdn.net/farway000" title="CSDN &rarr; https://blog.csdn.net/farway000" rel="noopener" target="_blank"><i class="fa fa-fw fa-CSDN"></i>CSDN</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">溪源</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.1.2</div>
#<div><a href="http://www.beian.miit.gov.cn/">ICP备案号:湘ICP备19001531号</a></div>



        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.2"></script>

  <script src="/js/motion.js?v=7.1.2"></script>



  
  


  <script src="/js/affix.js?v=7.1.2"></script>

  <script src="/js/schemes/pisces.js?v=7.1.2"></script>



  

  


  <script src="/js/next-boot.js?v=7.1.2"></script>


  

  

  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
